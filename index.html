<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vật Lý 11 - Chương 1: Dao Động</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- KaTeX for beautiful math rendering -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      xintegrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
      xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0i8"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
      xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        font-family: "Be Vietnam Pro", sans-serif;
        background-color: #f8fafc; /* Slate 50 */
      }
      .nav-btn {
        transition: all 0.3s ease;
        border-bottom-width: 4px;
        border-color: transparent;
      }
      .nav-btn.active {
        border-color: #0ea5e9; /* Sky 500 */
        color: #0c4a6e; /* Sky 900 */
        background-color: #e0f2fe; /* Sky 100 */
      }
      .content-section {
        display: none;
      }
      .content-section.active {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .formula-card {
        background-color: #f0f9ff; /* Sky 50 */
        border-left: 4px solid #38bdf8; /* Sky 400 */
        padding: 1rem;
        border-radius: 0.5rem;
      }
      .concept-card {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        height: 350px;
      }

      /* Animation for Simple Pendulum */
      .pendulum-container {
        position: relative;
        width: 150px;
        height: 200px;
        margin: 20px auto;
      }
      .pendulum-pivot {
        width: 20px;
        height: 10px;
        background: #475569; /* Slate 600 */
        border-radius: 5px;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        z-index: 2;
      }
      .pendulum-rod {
        width: 2px;
        height: 150px;
        background: #64748b; /* Slate 500 */
        position: absolute;
        left: 50%;
        transform-origin: top center;
        animation: swing 4s ease-in-out infinite;
      }
      .pendulum-bob {
        width: 30px;
        height: 30px;
        background: #0ea5e9; /* Sky 500 */
        border-radius: 50%;
        position: absolute;
        bottom: -15px;
        left: -14px;
      }
      @keyframes swing {
        0%,
        100% {
          transform: rotate(45deg);
        }
        50% {
          transform: rotate(-45deg);
        }
      }

      /* Animation for Spring Pendulum */
      .spring-container {
        position: relative;
        width: 150px;
        height: 250px;
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .spring-support {
        width: 100px;
        height: 10px;
        background: #475569; /* Slate 600 */
        border-radius: 5px;
      }
      .spring-mass {
        width: 50px;
        height: 50px;
        background: #10b981; /* Emerald 500 */
        border-radius: 8px;
        position: absolute;
        bottom: 0;
        left: 50px;
        animation: bounce 2s ease-in-out infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }
      .spring-coil {
        width: 20px;
        height: 150px;
        border: 2px solid #64748b;
        border-bottom: none;
        border-radius: 10px 10px 0 0;
        position: absolute;
        top: 10px;
        left: 65px;
        transform-origin: top;
        animation: stretch 2s ease-in-out infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-100px);
        }
      }
      @keyframes stretch {
        0%,
        100% {
          height: 150px;
        }
        50% {
          height: 50px;
        }
      }
    </style>
  </head>
  <body class="text-slate-800">
    <header class="bg-white shadow-md sticky top-0 z-10">
      <div class="container mx-auto px-4 py-4">
        <h1 class="text-2xl md:text-3xl font-bold text-sky-800">
          Chương I: Dao Động
        </h1>
        <p class="text-slate-600 mt-1">
          Khám phá các khái niệm về dao động một cách trực quan và tương tác.
        </p>
      </div>
    </header>

    <nav class="bg-white shadow-sm mb-8">
      <div class="container mx-auto px-4 flex flex-wrap justify-center">
        <button
          class="nav-btn active py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-1-2"
        >
          Bài 1-2: DĐĐH & Mô tả
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-3-5"
        >
          Bài 3-5: Lực, Năng lượng & Hệ dao động
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-6"
        >
          Bài 6: Các loại Dao động
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="simulations"
        >
          Mô Phỏng & Thí Nghiệm
        </button>
      </div>
    </nav>

    <main class="container mx-auto px-4 pb-12">
      <!-- Bài 1 & 2: Dao động điều hòa và Mô tả dao động -->
      <section id="lesson-1-2" class="content-section active">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 1 & 2: Dao Động Điều Hoà và Các Đại Lượng Đặc Trưng
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Các Khái Niệm Cơ Bản
          </h3>
          <p>
            <strong class="font-medium text-sky-600">Dao động cơ:</strong>
            Chuyển động lặp đi lặp lại quanh một vị trí cân bằng.
          </p>
          <p>
            <strong class="font-medium text-sky-600"
              >Dao động tuần hoàn:</strong
            >
            Sau những khoảng thời gian bằng nhau (chu kì), vật trở lại vị trí cũ
            theo hướng cũ.
          </p>
          <p>
            <strong class="font-medium text-sky-600"
              >Dao động điều hoà (DĐĐH):</strong
            >
            Là dao động tuần hoàn trong đó li độ của vật là một hàm côsin (hay
            sin) của thời gian. Đây là dạng dao động cơ đơn giản nhất.
          </p>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Phương Trình và Đồ Thị Dao Động Điều Hoà
          </h3>
          <div class="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <h4 class="font-semibold text-lg mb-2">Phương trình li độ</h4>
              <div class="formula-card text-center text-xl">
                $x = A\cos(\omega t + \phi)$
              </div>
              <ul class="list-disc list-inside mt-3 space-y-1 text-slate-600">
                <li>$x$: li độ (vị trí của vật)</li>
                <li>$A$: biên độ (li độ cực đại)</li>
                <li>$\omega$: tần số góc (rad/s)</li>
                <li>$(\omega t + \phi)$: pha dao động tại thời điểm t</li>
                <li>$\phi$: pha ban đầu (tại t=0)</li>
              </ul>
            </div>
            <div class="chart-container" style="height: 250px">
              <canvas id="shmGraph"></canvas>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Các Đại Lượng Đặc Trưng
          </h3>
          <div class="grid md:grid-cols-3 gap-4">
            <div class="formula-card">
              <h4 class="font-semibold">Chu kì (T)</h4>
              <p>$T = \frac{2\pi}{\omega} = \frac{1}{f}$</p>
              <p class="text-sm text-slate-600">
                Thời gian thực hiện 1 dao động (s).
              </p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Tần số (f)</h4>
              <p>$f = \frac{1}{T} = \frac{\omega}{2\pi}$</p>
              <p class="text-sm text-slate-600">
                Số dao động trong 1 giây (Hz).
              </p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Tần số góc ($\omega$)</h4>
              <p>$\omega = 2\pi f = \frac{2\pi}{T}$</p>
              <p class="text-sm text-slate-600">
                Tốc độ biến thiên của pha (rad/s).
              </p>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            4. Pha và Độ Lệch Pha
          </h3>
          <p class="mb-4 text-slate-600">
            Pha dao động xác định trạng thái (li độ và chiều chuyển động) của
            vật. Độ lệch pha cho biết sự sớm hay trễ pha giữa hai dao động cùng
            chu kì.
          </p>
          <div class="formula-card mb-4 text-center text-lg">
            Độ lệch pha: $\Delta\phi = \phi_2 - \phi_1$
          </div>
          <div class="grid md:grid-cols-3 gap-4 text-center">
            <div class="bg-slate-100 p-4 rounded-lg">
              <h4 class="font-semibold">Cùng pha</h4>
              <p>$\Delta\phi = 2k\pi$</p>
            </div>
            <div class="bg-slate-100 p-4 rounded-lg">
              <h4 class="font-semibold">Ngược pha</h4>
              <p>$\Delta\phi = (2k+1)\pi$</p>
            </div>
            <div class="bg-slate-100 p-4 rounded-lg">
              <h4 class="font-semibold">Vuông pha</h4>
              <p>$\Delta\phi = (2k+1)\frac{\pi}{2}$</p>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            5. Minh Họa Độ Lệch Pha
          </h3>
          <p class="text-slate-600 mb-4">
            Các đồ thị dưới đây cho thấy hai dao động (nét liền và nét đứt)
            trong các trường hợp lệch pha khác nhau.
          </p>
          <div class="grid md:grid-cols-3 gap-8 mt-4 text-center">
            <div>
              <h4 class="font-semibold mb-2">Cùng Pha ($\Delta\phi = 0$)</h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="inPhaseChart"></canvas>
              </div>
            </div>
            <div>
              <h4 class="font-semibold mb-2">Ngược Pha ($\Delta\phi = \pi$)</h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="outOfPhaseChart"></canvas>
              </div>
            </div>
            <div>
              <h4 class="font-semibold mb-2">
                Vuông Pha ($\Delta\phi = \pi/2$)
              </h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="quadraturePhaseChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bài 3 & 5: Vận tốc, Gia tốc và Năng lượng -->
      <section id="lesson-3-5" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 3 & 5: Lực, Năng Lượng và Các Hệ Dao Động
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Vận Tốc và Gia Tốc
          </h3>
          <p class="mb-4 text-slate-600">
            Vận tốc và gia tốc trong DĐĐH cũng biến thiên điều hoà nhưng lệch
            pha so với li độ. Biểu đồ dưới đây thể hiện mối quan hệ này.
          </p>
          <div class="chart-container">
            <canvas id="xvaChart"></canvas>
          </div>
          <div class="grid md:grid-cols-2 gap-4 mt-4">
            <div class="formula-card">
              <h4 class="font-semibold">Vận tốc (v)</h4>
              <p>$v = -\omega A\sin(\omega t + \phi)$</p>
              <p class="text-sm text-slate-600">
                Sớm pha $\frac{\pi}{2}$ so với li độ $x$.
              </p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Gia tốc (a)</h4>
              <p>$a = -\omega^2 A\cos(\omega t + \phi) = -\omega^2x$</p>
              <p class="text-sm text-slate-600">
                Ngược pha (lệch $\pi$) so với li độ $x$.
              </p>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Lực Kéo Về (Lực Hồi Phục)
          </h3>
          <p class="mb-4 text-slate-600">
            Là hợp lực tác dụng lên vật, luôn hướng về vị trí cân bằng và gây ra
            gia tốc cho vật. Lực này tỉ lệ với li độ và có chiều ngược với chiều
            của li độ.
          </p>
          <div class="formula-card text-center text-lg mb-4">
            $F = -kx = ma$
          </div>
          <div class="mt-6">
            <h4 class="font-semibold text-lg mb-2 text-center">
              Mô phỏng Lực kéo về
            </h4>
            <canvas
              id="restoringForceCanvas"
              height="100"
              class="w-full bg-slate-50 rounded-lg"
            ></canvas>
            <p class="text-center text-sm mt-2 text-slate-600">
              Mũi tên màu đỏ biểu diễn vector lực kéo về, luôn hướng về VTCB và
              có độ lớn tỉ lệ với li độ.
            </p>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Năng Lượng trong DĐĐH
          </h3>
          <p class="mb-4 text-slate-600">
            Cơ năng được bảo toàn. Động năng và thế năng biến thiên tuần hoàn
            với tần số góc $2\omega$ và chu kì $T/2$.
          </p>
          <div class="chart-container">
            <canvas id="energyChart"></canvas>
          </div>
          <div class="grid md:grid-cols-3 gap-4 mt-4">
            <div class="formula-card">
              <h4 class="font-semibold">Động năng</h4>
              <p>$W_đ = \frac{1}{2}mv^2$</p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Thế năng</h4>
              <p>$W_t = \frac{1}{2}kx^2$</p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Cơ năng</h4>
              <p>$W = W_đ + W_t = \frac{1}{2}kA^2$</p>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            4. Các Hệ Dao Động Cơ Học
          </h3>
          <div class="grid md:grid-cols-2 gap-8 mt-4">
            <div>
              <h4 class="text-lg font-semibold mb-2 text-emerald-700">
                Con lắc lò xo
              </h4>
              <p class="text-slate-600">
                Gồm một vật nhỏ khối lượng $m$ gắn vào một lò xo có độ cứng $k$.
                Dao động điều hoà nếu bỏ qua ma sát.
              </p>
              <div class="formula-card mt-2">
                <p>Tần số góc: $\omega = \sqrt{\frac{k}{m}}$</p>
                <p>Chu kì: $T = 2\pi\sqrt{\frac{m}{k}}$</p>
              </div>
            </div>
            <div>
              <h4 class="text-lg font-semibold mb-2 text-sky-700">
                Con lắc đơn
              </h4>
              <p class="text-slate-600">
                Gồm một vật nhỏ khối lượng $m$ treo ở đầu một sợi dây dài $l$.
                Dao động điều hoà với góc lệch nhỏ.
              </p>
              <div class="formula-card mt-2">
                <p>Tần số góc: $\omega = \sqrt{\frac{g}{l}}$</p>
                <p>Chu kì: $T = 2\pi\sqrt{\frac{l}{g}}$</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bài 6: Các loại dao động khác -->
      <section id="lesson-6" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 6: Dao Động Tắt Dần, Cưỡng Bức và Cộng Hưởng
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. So Sánh Các Loại Dao Động
          </h3>
          <p class="mb-4 text-slate-600">
            Chọn một loại dao động để xem đồ thị li độ theo thời gian của nó.
          </p>
          <div
            class="flex justify-center space-x-2 md:space-x-4 mb-4 flex-wrap"
          >
            <button
              id="btn-damped"
              class="px-4 py-2 bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition"
            >
              Tắt dần
            </button>
            <button
              id="btn-maintained"
              class="px-4 py-2 bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition"
            >
              Duy trì
            </button>
            <button
              id="btn-forced"
              class="px-4 py-2 bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition"
            >
              Cưỡng bức
            </button>
          </div>
          <div class="chart-container">
            <canvas id="oscillationTypeChart"></canvas>
          </div>
          <div
            id="oscillation-description"
            class="mt-4 p-4 bg-slate-100 rounded-lg text-slate-700"
          >
            <!-- Description will be loaded by JS -->
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Hiện Tượng Cộng Hưởng
          </h3>
          <p class="text-slate-600">
            Là hiện tượng biên độ dao động cưỡng bức tăng đến giá trị cực đại
            khi tần số của lực cưỡng bức ($f$) tiến đến bằng tần số dao động
            riêng ($f_0$) của hệ. Hiện tượng này có cả ứng dụng lợi và hại trong
            thực tế.
          </p>
          <div class="mt-4 grid md:grid-cols-2 gap-4">
            <div
              class="bg-emerald-50 border-l-4 border-emerald-500 p-4 rounded"
            >
              <h4 class="font-bold text-emerald-800">Có Lợi</h4>
              <p>
                Hộp đàn guitar, violon; mạch chọn sóng trong radio, TV; lò vi
                sóng.
              </p>
            </div>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
              <h4 class="font-bold text-red-800">Có Hại</h4>
              <p>
                Các công trình như cầu, tòa nhà, bệ máy có thể bị rung lắc mạnh
                đến sụp đổ nếu tần số của ngoại lực (gió, động cơ, bước chân
                đoàn người) trùng với tần số riêng.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Mô phỏng -->
      <section id="simulations" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Mô Phỏng & Thí Nghiệm Trực Quan
        </h2>
        <p class="mb-8 text-slate-600">
          Quan sát các mô hình dao động cơ bản và các công thức liên quan.
        </p>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Con Lắc Lò Xo và Con Lắc Đơn
          </h3>
          <div class="grid md:grid-cols-2 gap-8">
            <!-- Con lắc lò xo -->
            <div class="bg-white p-6 rounded-lg border text-center">
              <h4 class="text-xl font-semibold mb-4 text-emerald-700">
                Con Lắc Lò Xo
              </h4>
              <div class="spring-container">
                <div class="spring-support"></div>
                <div class="spring-coil"></div>
                <div class="spring-mass">m</div>
              </div>
              <div class="formula-card space-y-2 mt-4">
                <p>$\omega = \sqrt{\frac{k}{m}}$</p>
                <p>$T = 2\pi\sqrt{\frac{m}{k}}$</p>
              </div>
            </div>
            <!-- Con lắc đơn -->
            <div class="bg-white p-6 rounded-lg border text-center">
              <h4 class="text-xl font-semibold mb-4 text-sky-700">
                Con Lắc Đơn
              </h4>
              <div class="pendulum-container">
                <div class="pendulum-pivot"></div>
                <div class="pendulum-rod"><div class="pendulum-bob"></div></div>
              </div>
              <div class="formula-card space-y-2 mt-4">
                <p>$\omega = \sqrt{\frac{g}{l}}$</p>
                <p>$T = 2\pi\sqrt{\frac{l}{g}}$</p>
              </div>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Tương Tác: Khảo Sát Độ Lệch Pha
          </h3>
          <p class="mb-4 text-slate-600">
            Sử dụng các thanh trượt để thay đổi pha ban đầu của hai dao động và
            quan sát sự thay đổi trên đồ thị cũng như giá trị độ lệch pha.
          </p>
          <div class="chart-container">
            <canvas id="phaseShiftChart"></canvas>
          </div>
          <div class="grid md:grid-cols-2 gap-6 mt-6">
            <div>
              <label for="phi1" class="block font-medium mb-1"
                >Pha ban đầu $\phi_1$ ($ \times\pi$ rad)</label
              >
              <input
                type="range"
                id="phi1"
                min="-2"
                max="2"
                value="0"
                step="0.1"
                class="w-full"
              />
              <p class="text-center mt-1">
                $\phi_1 = $ <span id="phi1Value">0.00</span>$\pi$ rad
              </p>
            </div>
            <div>
              <label for="phi2" class="block font-medium mb-1"
                >Pha ban đầu $\phi_2$ ($ \times\pi$ rad)</label
              >
              <input
                type="range"
                id="phi2"
                min="-2"
                max="2"
                value="0.5"
                step="0.1"
                class="w-full"
              />
              <p class="text-center mt-1">
                $\phi_2 = $ <span id="phi2Value">0.50</span>$\pi$ rad
              </p>
            </div>
          </div>
          <div
            class="mt-4 text-center text-lg font-semibold bg-sky-100 text-sky-800 p-3 rounded-md"
          >
            Độ lệch pha $\Delta\phi = $
            <span id="deltaPhiValue">0.50</span>$\pi$ rad
          </div>
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const navButtons = document.querySelectorAll(".nav-btn");
        const contentSections = document.querySelectorAll(".content-section");
        const charts = {};

        // KaTeX auto-rendering
        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
            { left: "\\(", right: "\\)", display: false },
            { left: "\\[", right: "\\]", display: true },
          ],
          throwOnError: false,
        });

        function switchTab(targetId) {
          contentSections.forEach((section) =>
            section.classList.remove("active")
          );
          navButtons.forEach((button) => button.classList.remove("active"));

          document.getElementById(targetId).classList.add("active");
          document
            .querySelector(`[data-target="${targetId}"]`)
            .classList.add("active");

          initializeChart(targetId);
        }

        navButtons.forEach((button) => {
          button.addEventListener("click", () => {
            const targetId = button.getAttribute("data-target");
            switchTab(targetId);
          });
        });

        function initializeChart(targetId) {
          if (charts[targetId]) {
            return;
          }
          charts[targetId] = true;

          switch (targetId) {
            case "lesson-1-2":
              createShmGraph();
              createPhaseCharts();
              break;
            case "lesson-3-5":
              createXvaChart();
              createEnergyChart();
              createRestoringForceAnimation();
              break;
            case "lesson-6":
              createOscillationTypeChart();
              break;
            case "simulations":
              createPhaseShiftChart();
              break;
          }
        }

        function createShmGraph() {
          const ctx = document.getElementById("shmGraph").getContext("2d");
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.25).toFixed(2)
          );
          charts["shmGraph"] = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Đồ thị li độ x-t",
                  data: labels.map((t) => 10 * Math.cos((Math.PI / 2) * t)),
                  borderColor: "#38bdf8",
                  backgroundColor: "rgba(56, 189, 248, 0.1)",
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                x: { title: { display: true, text: "t(s)" } },
                y: { title: { display: true, text: "x(cm)" } },
              },
            },
          });
        }

        function createXvaChart() {
          const ctx = document.getElementById("xvaChart").getContext("2d");
          const A = 5,
            omega = Math.PI;
          const labels = Array.from({ length: 41 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          charts["xvaChart"] = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Li độ x (cm)",
                  data: labels.map((t) => A * Math.cos(omega * t)),
                  borderColor: "#38bdf8",
                  fill: false,
                  tension: 0.1,
                },
                {
                  label: "Vận tốc v (cm/s)",
                  data: labels.map((t) => -A * omega * Math.sin(omega * t)),
                  borderColor: "#10b981",
                  fill: false,
                  tension: 0.1,
                },
                {
                  label: "Gia tốc a (cm/s²)",
                  data: labels.map(
                    (t) => -A * omega * omega * Math.cos(omega * t)
                  ),
                  borderColor: "#f97316",
                  fill: false,
                  tension: 0.1,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: false,
                  title: { display: true, text: "Giá trị" },
                },
                x: { title: { display: true, text: "Thời gian (s)" } },
              },
            },
          });
        }

        function createEnergyChart() {
          const ctx = document.getElementById("energyChart").getContext("2d");
          const k = 20,
            A = 0.1,
            m = 0.2;
          const W = 0.5 * k * A * A;
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          const omega = Math.sqrt(k / m);

          charts["energyChart"] = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Động năng (Wđ)",
                  data: labels.map((t) => W * Math.pow(Math.sin(omega * t), 2)),
                  backgroundColor: "rgba(16, 185, 129, 0.5)",
                  borderColor: "#10b981",
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Thế năng (Wt)",
                  data: labels.map((t) => W * Math.pow(Math.cos(omega * t), 2)),
                  backgroundColor: "rgba(56, 189, 248, 0.5)",
                  borderColor: "#38bdf8",
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Cơ năng (W)",
                  data: labels.map(() => W),
                  borderColor: "#ef4444",
                  fill: false,
                  borderWidth: 3,
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: {
                y: {
                  beginAtZero: true,
                  stacked: true,
                  title: { display: true, text: "Năng lượng (J)" },
                },
                x: { title: { display: true, text: "Thời gian (s)" } },
              },
            },
          });
        }

        function createPhaseCharts() {
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          const data1 = labels.map((t) => 10 * Math.cos(2 * Math.PI * t));
          const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { ticks: { display: false }, grid: { display: false } },
              y: { ticks: { display: false }, grid: { display: false } },
            },
            elements: { line: { tension: 0.4 } },
          };

          // In-phase
          const ctxInPhase = document
            .getElementById("inPhaseChart")
            .getContext("2d");
          new Chart(ctxInPhase, {
            type: "line",
            data: {
              labels,
              datasets: [
                { data: data1, borderColor: "#38bdf8", pointRadius: 0 },
                {
                  data: labels.map((t) => 10 * Math.cos(2 * Math.PI * t)),
                  borderColor: "#10b981",
                  pointRadius: 0,
                  borderDash: [5, 5],
                },
              ],
            },
            options: commonOptions,
          });

          // Out-of-phase
          const ctxOutOfPhase = document
            .getElementById("outOfPhaseChart")
            .getContext("2d");
          new Chart(ctxOutOfPhase, {
            type: "line",
            data: {
              labels,
              datasets: [
                { data: data1, borderColor: "#38bdf8", pointRadius: 0 },
                {
                  data: labels.map(
                    (t) => 10 * Math.cos(2 * Math.PI * t + Math.PI)
                  ),
                  borderColor: "#f97316",
                  pointRadius: 0,
                  borderDash: [5, 5],
                },
              ],
            },
            options: commonOptions,
          });

          // Quadrature
          const ctxQuadrature = document
            .getElementById("quadraturePhaseChart")
            .getContext("2d");
          new Chart(ctxQuadrature, {
            type: "line",
            data: {
              labels,
              datasets: [
                { data: data1, borderColor: "#38bdf8", pointRadius: 0 },
                {
                  data: labels.map(
                    (t) => 10 * Math.cos(2 * Math.PI * t + Math.PI / 2)
                  ),
                  borderColor: "#a855f7",
                  pointRadius: 0,
                  borderDash: [5, 5],
                },
              ],
            },
            options: commonOptions,
          });
        }

        function createRestoringForceAnimation() {
          const canvas = document.getElementById("restoringForceCanvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          let animationFrameId;

          function resizeCanvas() {
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = 100;
          }
          resizeCanvas();
          window.addEventListener("resize", resizeCanvas);

          const w = canvas.width;
          const h = canvas.height;
          const centerX = w / 2;
          const centerY = h / 2 - 10;
          const amplitude = w * 0.4;
          const massRadius = 15;
          const arrowHeight = h / 2 + 30;

          function drawArrow(x, y, length) {
            if (Math.abs(length) < 1) return;
            ctx.beginPath();
            ctx.moveTo(x, y);
            ctx.lineTo(x + length, y);
            ctx.strokeStyle = "#ef4444";
            ctx.lineWidth = 3;
            ctx.stroke();

            ctx.beginPath();
            const sign = Math.sign(length);
            ctx.moveTo(x + length, y);
            ctx.lineTo(x + length - sign * 10, y - 5);
            ctx.lineTo(x + length - sign * 10, y + 5);
            ctx.closePath();
            ctx.fillStyle = "#ef4444";
            ctx.fill();
          }

          function animate(time) {
            const w = canvas.width;
            const h = canvas.height;
            const centerX = w / 2;
            const amplitude = w * 0.4;

            const t = time / 1000;
            const x_pos = amplitude * Math.cos(t);
            const forceMagnitude = -x_pos * 0.8;

            ctx.clearRect(0, 0, w, h);

            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, h);
            ctx.strokeStyle = "#cbd5e1";
            ctx.setLineDash([5, 5]);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.beginPath();
            ctx.arc(centerX + x_pos, centerY, massRadius, 0, 2 * Math.PI);
            ctx.fillStyle = "#0ea5e9";
            ctx.fill();

            drawArrow(centerX + x_pos, arrowHeight, forceMagnitude);

            animationFrameId = requestAnimationFrame(animate);
          }
          // Cancel any previous animation frame before starting a new one
          if (animationFrameId) {
            cancelAnimationFrame(animationFrameId);
          }
          animate(0);
        }

        function createOscillationTypeChart() {
          const ctx = document
            .getElementById("oscillationTypeChart")
            .getContext("2d");
          const descriptionDiv = document.getElementById(
            "oscillation-description"
          );
          const labels = Array.from({ length: 101 }, (_, i) =>
            (i * 0.2).toFixed(1)
          );

          const dataSets = {
            damped: {
              label: "Dao động tắt dần",
              data: labels.map(
                (t) => 10 * Math.exp(-0.15 * t) * Math.cos(2 * Math.PI * t)
              ),
              borderColor: "#f59e0b",
              description: `<h4 class="font-semibold text-lg">Dao động Tắt dần</h4><p>Dao động có biên độ giảm dần theo thời gian do tác dụng của lực cản, ma sát làm tiêu hao cơ năng.</p>`,
            },
            maintained: {
              label: "Dao động duy trì",
              data: labels.map((t) => 10 * Math.cos(2 * Math.PI * t)),
              borderColor: "#0ea5e9",
              description: `<h4 class="font-semibold text-lg">Dao động Duy trì</h4><p>Hệ được cung cấp năng lượng đúng bằng phần đã mất sau mỗi chu kì, làm cho biên độ không đổi.</p>`,
            },
            forced: {
              label: "Dao động cưỡng bức",
              data: labels.map((t) => 8 * Math.cos(1.8 * Math.PI * t)),
              borderColor: "#10b981",
              description: `<h4 class="font-semibold text-lg">Dao động Cưỡng bức</h4><p>Dao động dưới tác dụng của một ngoại lực tuần hoàn. Tần số dao động bằng tần số của ngoại lực.</p>`,
            },
          };

          const chart = new Chart(ctx, {
            type: "line",
            data: { labels: labels, datasets: [dataSets.damped] },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              scales: { y: { min: -12, max: 12 } },
            },
          });
          charts["oscillationTypeChart"] = chart;
          descriptionDiv.innerHTML = dataSets.damped.description;

          document
            .getElementById("btn-damped")
            .addEventListener("click", () => {
              chart.data.datasets = [dataSets.damped];
              chart.update();
              descriptionDiv.innerHTML = dataSets.damped.description;
            });
          document
            .getElementById("btn-maintained")
            .addEventListener("click", () => {
              chart.data.datasets = [dataSets.maintained];
              chart.update();
              descriptionDiv.innerHTML = dataSets.maintained.description;
            });
          document
            .getElementById("btn-forced")
            .addEventListener("click", () => {
              chart.data.datasets = [dataSets.forced];
              chart.update();
              descriptionDiv.innerHTML = dataSets.forced.description;
            });
        }

        function createPhaseShiftChart() {
          const ctx = document
            .getElementById("phaseShiftChart")
            .getContext("2d");
          const phi1Slider = document.getElementById("phi1"),
            phi2Slider = document.getElementById("phi2");
          const phi1Value = document.getElementById("phi1Value"),
            phi2Value = document.getElementById("phi2Value");
          const deltaPhiValue = document.getElementById("deltaPhiValue");
          const labels = Array.from({ length: 101 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );

          function getWaveData(phi) {
            return labels.map(
              (t) => 10 * Math.cos(Math.PI * t + phi * Math.PI)
            );
          }

          const chart = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Dao động 1",
                  data: getWaveData(parseFloat(phi1Slider.value)),
                  borderColor: "#38bdf8",
                  borderWidth: 2,
                  pointRadius: 0,
                },
                {
                  label: "Dao động 2",
                  data: getWaveData(parseFloat(phi2Slider.value)),
                  borderColor: "#10b981",
                  borderWidth: 2,
                  pointRadius: 0,
                },
              ],
            },
            options: { responsive: true, maintainAspectRatio: false },
          });
          charts["phaseShiftChart"] = chart;

          function updateChart() {
            const phi1 = parseFloat(phi1Slider.value);
            const phi2 = parseFloat(phi2Slider.value);
            phi1Value.textContent = phi1.toFixed(2);
            phi2Value.textContent = phi2.toFixed(2);
            deltaPhiValue.textContent = (phi2 - phi1).toFixed(2);
            chart.data.datasets[0].data = getWaveData(phi1);
            chart.data.datasets[1].data = getWaveData(phi2);
            chart.update();
          }

          phi1Slider.addEventListener("input", updateChart);
          phi2Slider.addEventListener("input", updateChart);
          updateChart();
        }

        switchTab("lesson-1-2");
      });
    </script>
  </body>
</html>
