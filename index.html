<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vật Lý 11 - Chương 1: Dao Động</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- KaTeX for beautiful math rendering -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      xintegrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
      xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0i8"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
      xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        font-family: "Be Vietnam Pro", sans-serif;
        background-color: #f8fafc; /* Slate 50 */
      }
      .nav-btn {
        transition: all 0.3s ease;
        border-bottom-width: 4px;
        border-color: transparent;
      }
      .nav-btn.active {
        border-color: #0ea5e9; /* Sky 500 */
        color: #0c4a6e; /* Sky 900 */
        background-color: #e0f2fe; /* Sky 100 */
      }
      .content-section {
        display: none;
      }
      .content-section.active {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .formula-card {
        background-color: #f0f9ff; /* Sky 50 */
        border-left: 4px solid #38bdf8; /* Sky 400 */
        padding: 1rem;
        border-radius: 0.5rem;
      }
      .concept-card {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        height: 350px;
      }
      /* Custom checkbox styles */
      .toggle-checkbox:checked {
        background-color: #0ea5e9;
        border-color: #0ea5e9;
      }
      .toggle-checkbox:checked + .toggle-label {
        color: #0c4a6e;
        font-weight: 600;
      }

      /* Animation for Simple Pendulum */
      .pendulum-container {
        position: relative;
        width: 150px;
        height: 200px;
        margin: 20px auto;
      }
      .pendulum-pivot {
        width: 20px;
        height: 10px;
        background: #475569; /* Slate 600 */
        border-radius: 5px;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        z-index: 2;
      }
      .pendulum-rod {
        width: 2px;
        height: 150px;
        background: #64748b; /* Slate 500 */
        position: absolute;
        left: 50%;
        transform-origin: top center;
        animation: swing 4s ease-in-out infinite;
      }
      .pendulum-bob {
        width: 30px;
        height: 30px;
        background: #0ea5e9; /* Sky 500 */
        border-radius: 50%;
        position: absolute;
        bottom: -15px;
        left: -14px;
      }
      @keyframes swing {
        0%,
        100% {
          transform: rotate(45deg);
        }
        50% {
          transform: rotate(-45deg);
        }
      }

      /* Animation for Spring Pendulum */
      .spring-container {
        position: relative;
        width: 150px;
        height: 250px;
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .spring-support {
        width: 100px;
        height: 10px;
        background: #475569; /* Slate 600 */
        border-radius: 5px;
      }
      .spring-mass {
        width: 50px;
        height: 50px;
        background: #10b981; /* Emerald 500 */
        border-radius: 8px;
        position: absolute;
        bottom: 0;
        left: 50px;
        animation: bounce 2s ease-in-out infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }
      .spring-coil {
        width: 20px;
        height: 150px;
        border: 2px solid #64748b;
        border-bottom: none;
        border-radius: 10px 10px 0 0;
        position: absolute;
        top: 10px;
        left: 65px;
        transform-origin: top;
        animation: stretch 2s ease-in-out infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-100px);
        }
      }
      @keyframes stretch {
        0%,
        100% {
          height: 150px;
        }
        50% {
          height: 50px;
        }
      }

      /* Quiz styles */
      .quiz-question {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #e2e8f0; /* Slate 200 */
      }
      .quiz-question:last-of-type {
        border-bottom: none;
      }
      .quiz-options label {
        display: block;
        padding: 0.75rem 1rem;
        border: 1px solid #cbd5e1; /* Slate 300 */
        border-radius: 0.5rem;
        margin-bottom: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .quiz-options input:checked + label {
        background-color: #e0f2fe; /* Sky 100 */
        border-color: #38bdf8; /* Sky 400 */
        font-weight: 500;
      }
      .quiz-options input {
        display: none;
      }
      .quiz-options label.correct {
        background-color: #dcfce7; /* Green 100 */
        border-color: #22c55e; /* Green 500 */
      }
      .quiz-options label.incorrect {
        background-color: #fee2e2; /* Red 100 */
        border-color: #ef4444; /* Red 500 */
      }
      .explanation {
        margin-top: 0.75rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        display: none;
      }
      .explanation.correct {
        background-color: #f0fdf4; /* Green 50 */
        color: #15803d; /* Green 700 */
        display: block;
      }
      .explanation.incorrect {
        background-color: #fef2f2; /* Red 50 */
        color: #b91c1c; /* Red 700 */
        display: block;
      }
    </style>
  </head>
  <body class="text-slate-800">
    <header class="bg-white shadow-md sticky top-0 z-10">
      <div class="container mx-auto px-4 py-4">
        <h1 class="text-2xl md:text-3xl font-bold text-sky-800">
          Chương I: Dao Động
        </h1>
        <p class="text-slate-600 mt-1">
          Khám phá các khái niệm về dao động một cách trực quan và tương tác.
        </p>
      </div>
    </header>

    <nav class="bg-white shadow-sm mb-8">
      <div class="container mx-auto px-4 flex flex-wrap justify-center">
        <button
          class="nav-btn active py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-1-2"
        >
          Bài 1-2: DĐĐH & Mô tả
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-3-5"
        >
          Bài 3-5: Vận tốc, Gia tốc & Năng lượng
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-6"
        >
          Bài 6: Các loại Dao động
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="simulations"
        >
          Mô Phỏng & Thí Nghiệm
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="exercises"
        >
          Bài Tập
        </button>
      </div>
    </nav>

    <main class="container mx-auto px-4 pb-12">
      <!-- Bài 1 & 2: Dao động điều hòa và Mô tả dao động -->
      <section id="lesson-1-2" class="content-section active">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 1 & 2: Dao Động Điều Hoà và Các Đại Lượng Đặc Trưng
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Các Khái Niệm Cơ Bản
          </h3>
          <div class="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <p class="mb-4">
                <strong class="font-medium text-sky-600">Dao động cơ:</strong>
                Là chuyển động lặp đi lặp lại của một vật quanh một vị trí đặc
                biệt, gọi là vị trí cân bằng.
              </p>
              <p class="mb-4">
                <strong class="font-medium text-sky-600"
                  >Dao động tuần hoàn:</strong
                >
                Là dao động mà sau những khoảng thời gian bằng nhau (chu kì),
                vật trở lại vị trí cũ theo hướng cũ.
              </p>
              <p class="mb-2">
                <strong class="font-medium text-sky-600"
                  >Dao động điều hoà (DĐĐH):</strong
                >
                Là dao động tuần hoàn trong đó li độ của vật là một hàm côsin
                (hay sin) của thời gian.
              </p>
            </div>
            <div class="text-center">
              <canvas
                id="basic-oscillation-canvas"
                height="150"
                class="w-full max-w-sm mx-auto bg-slate-50 rounded-lg"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Mô phỏng vật dao động quanh vị trí cân bằng (đường nét đứt).
              </p>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Phương Trình và Đồ Thị Dao Động Điều Hoà
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <h4 class="font-semibold text-lg mb-2">Phương trình li độ</h4>
              <div class="formula-card text-center text-xl">
                $x = A\cos(\omega t + \phi)$
              </div>
              <ul class="list-disc list-inside mt-3 space-y-1 text-slate-600">
                <li>$x$: li độ (vị trí của vật)</li>
                <li>$A$: biên độ (li độ cực đại)</li>
                <li>$\omega$: tần số góc (rad/s)</li>
                <li>$(\omega t + \phi)$: pha dao động</li>
                <li>$\phi$: pha ban đầu</li>
              </ul>
            </div>
            <div class="chart-container" style="height: 250px">
              <canvas id="shmGraph"></canvas>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Mối Liên Hệ Giữa DĐĐH và Chuyển Động Tròn Đều
          </h3>
          <p class="text-slate-600 mb-4">
            Dao động điều hoà có thể được coi là hình chiếu của một chuyển động
            tròn đều lên một trục. Điều này giúp giải thích các đại lượng trong
            phương trình DĐĐH.
          </p>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div class="text-center">
              <canvas
                id="circular-motion-canvas"
                class="w-full max-w-xs mx-auto"
                width="250"
                height="250"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Điểm P (DĐĐH) là hình chiếu của điểm M (chuyển động tròn đều).
              </p>
            </div>
            <div>
              <ul class="space-y-2 text-slate-600">
                <li>
                  <strong class="font-medium text-sky-700">Biên độ A</strong>
                  tương ứng với
                  <strong class="font-medium text-sky-700">bán kính</strong> của
                  chuyển động tròn.
                </li>
                <li>
                  <strong class="font-medium text-sky-700"
                    >Tần số góc $\omega$</strong
                  >
                  tương ứng với
                  <strong class="font-medium text-sky-700">tốc độ góc</strong>
                  của chuyển động tròn.
                </li>
                <li>
                  <strong class="font-medium text-sky-700"
                    >Pha dao động $(\omega t + \phi)$</strong
                  >
                  tương ứng với
                  <strong class="font-medium text-sky-700">góc quay</strong> của
                  bán kính tại thời điểm t.
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            4. Các Đại Lượng Đặc Trưng
          </h3>
          <div class="grid md:grid-cols-3 gap-4">
            <div class="formula-card">
              <h4 class="font-semibold">Chu kì (T)</h4>
              <p>$T = \frac{2\pi}{\omega} = \frac{1}{f}$</p>
              <p class="text-sm text-slate-600">
                Thời gian để thực hiện một dao động toàn phần (s).
              </p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Tần số (f)</h4>
              <p>$f = \frac{1}{T} = \frac{\omega}{2\pi}$</p>
              <p class="text-sm text-slate-600">
                Số dao động thực hiện trong một giây (Hz).
              </p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Tần số góc ($\omega$)</h4>
              <p>$\omega = 2\pi f = \frac{2\pi}{T}$</p>
              <p class="text-sm text-slate-600">
                Tốc độ biến thiên của pha (rad/s).
              </p>
            </div>
          </div>
          <p class="mt-4 text-slate-600">
            Biên độ, chu kì, tần số và tần số góc là những hằng số đặc trưng cho
            một dao động cụ thể và hoàn toàn không phụ thuộc vào thời điểm quan
            sát.
          </p>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            5. Pha ban đầu
          </h3>
          <p class="text-slate-600 mb-4">
            Pha ban đầu ($\phi$): Đại lượng này có vai trò xác định trạng thái
            xuất phát của dao động. Nó "cho biết tại thời điểm bắt đầu quan sát
            vật dao động điều hoà ở đâu và sẽ đi về phía nào".
          </p>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            6. Minh Họa Độ Lệch Pha
          </h3>
          <p class="text-slate-600 mb-4">
            Độ lệch pha quan trọng hơn pha, vì nó là đại lượng không đổi, không
            phụ thuộc vào thời điểm quan sát.
          </p>
          <p class="text-slate-600 mb-4">
            Độ lệch pha $\Delta\phi = \phi_2 - \phi_1$ cho biết sự sớm hay trễ
            pha giữa hai dao động.
          </p>
          <div class="grid md:grid-cols-3 gap-8 mt-4 text-center">
            <div>
              <h4 class="font-semibold mb-2">
                Cùng Pha ($\Delta\phi = 2k\pi$ |$(0)$)
              </h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="inPhaseChart"></canvas>
              </div>
            </div>
            <div>
              <h4 class="font-semibold mb-2">
                Ngược Pha ($\Delta\phi = (2k+1)\pi$ | $(\pi)$)
              </h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="outOfPhaseChart"></canvas>
              </div>
            </div>
            <div>
              <h4 class="font-semibold mb-2">
                Vuông Pha ($\Delta\phi = (2k+1)\frac{\pi}{2}$ |
                $(\frac{\pi}{2})$)
              </h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="quadraturePhaseChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bài 3 & 5: Vận tốc, Gia tốc và Năng lượng -->
      <section id="lesson-3-5" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 3 & 5: Vận Tốc, Gia Tốc và Năng Lượng
        </h2>
        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            0. Phương trình li độ
          </h3>
          <div class="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <div class="formula-card mb-4">
                <h4 class="font-semibold">Li độ ($x$)</h4>
                <p>$x = A\cos(\omega t + \phi)$</p>
              </div>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Vận Tốc và Gia Tốc
          </h3>
          <div class="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <div class="formula-card mb-4">
                <h4 class="font-semibold">Vận tốc (v)</h4>
                <p>
                  $v = x' = -\omega A\sin(\omega t + \phi) = \omega A\cos(\omega
                  t + \phi + \frac{\pi}{2})$
                </p>

                <p class="text-sm text-slate-600 mt-1">
                  Độ lớn: $v = \pm\omega\sqrt{A^2 - x^2}$
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Sớm pha $\frac{\pi}{2}$ so với li độ $x$.
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Cực đại tại vị trí cân bằng ($v = \pm\omega A$), bằng 0 tại
                  biên.
                </p>
              </div>
              <div class="formula-card">
                <h4 class="font-semibold">Gia tốc (a)</h4>
                <p>
                  $a = v' = x'' = -\omega^2\cos(\omega t + \phi) =
                  \omega^2\cos(\omega t + \phi + \pi) = -\omega^2x$
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Cực đại tại vị trí biên ($a = \pm\omega^2A$), bằng 0 tại vị
                  trí cân bằng.
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Ngược pha $\pi$ với li độ $x$ và sớm pha $\frac{\pi}{2}$ so
                  với vận tốc.
                </p>
              </div>
            </div>
            <div class="text-center">
              <canvas
                id="vector-animation-canvas"
                height="180"
                class="w-full max-w-sm mx-auto bg-slate-50 rounded-lg"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Mô phỏng vector vận tốc (<span
                  class="text-emerald-500 font-semibold"
                  >màu xanh</span
                >) và gia tốc (<span class="text-orange-500 font-semibold"
                  >màu cam</span
                >).
              </p>
            </div>
          </div>
          <div class="chart-container mt-6">
            <canvas id="xvaChart"></canvas>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Bảng Tóm Tắt Mối Quan Hệ Giữa x, v, a
          </h3>
          <p class="text-slate-600 mb-4">
            Bảng dưới đây tóm tắt giá trị và trạng thái của các đại lượng li độ,
            vận tốc và gia tốc tại các vị trí đặc biệt trong quá trình dao động.
          </p>
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-slate-500">
              <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                <tr>
                  <th scope="col" class="px-6 py-3">Vị trí</th>
                  <th scope="col" class="px-6 py-3">Li độ (x)</th>
                  <th scope="col" class="px-6 py-3">Vận tốc (v)</th>
                  <th scope="col" class="px-6 py-3">Gia tốc (a)</th>
                </tr>
              </thead>
              <tbody>
                <tr class="bg-white border-b">
                  <th
                    scope="row"
                    class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap"
                  >
                    Biên dương
                  </th>
                  <td class="px-6 py-4">$x = +A$ (Cực đại)</td>
                  <td class="px-6 py-4">$v = 0$</td>
                  <td class="px-6 py-4">$a = -\omega^2A$ (Cực tiểu)</td>
                </tr>
                <tr class="bg-slate-50 border-b">
                  <th
                    scope="row"
                    class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap"
                  >
                    Vị trí cân bằng
                  </th>
                  <td class="px-6 py-4">$x = 0$</td>
                  <td class="px-6 py-4">$v = \pm\omega A$ (Cực đại)</td>
                  <td class="px-6 py-4">$a = 0$</td>
                </tr>
                <tr class="bg-white border-b">
                  <th
                    scope="row"
                    class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap"
                  >
                    Biên âm
                  </th>
                  <td class="px-6 py-4">$x = -A$ (Cực tiểu)</td>
                  <td class="px-6 py-4">$v = 0$</td>
                  <td class="px-6 py-4">$a = +\omega^2A$ (Cực đại)</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Năng Lượng trong DĐĐH
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="mb-4 text-slate-600">
                Cơ năng được bảo toàn. Động năng và thế năng biến thiên tuần
                hoàn, chuyển hóa qua lại lẫn nhau.
              </p>
              <div class="formula-card mb-4">
                <h4 class="font-semibold">Động năng ($W_đ$)</h4>
                <p>$W_đ = \frac{1}{2}mv^2 = \frac{1}{2}m\omega^2(A^2 - x^2)$</p>
                <br />
                <p>$W_đmax = \frac{1}{2}m\omega^2A^2$</p>
              </div>

              <div class="formula-card mb-4">
                <h4 class="font-semibold">Thế năng ($W_t$)</h4>
                <p>$W_t = \frac{1}{2}m\omega^2x^2$</p>
                <br />
                <p>$W_tmax = W_đmax = \frac{1}{2}m\omega^2A^2$</p>
              </div>

              <div class="formula-card">
                <h4 class="font-semibold">Cơ năng ($W$)</h4>
                <p>$W = W_đ + W_t = \frac{1}{2}m\omega^2A^2 = hằng số$</p>
              </div>
            </div>
            <div class="text-center">
              <canvas
                id="energy-bar-canvas"
                height="200"
                class="w-full max-w-sm mx-auto"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Sự chuyển hoá giữa Động năng (<span
                  class="text-emerald-500 font-semibold"
                  >Wđ</span
                >) và Thế năng (<span class="text-sky-500 font-semibold"
                  >Wt</span
                >).
              </p>
            </div>
          </div>
          <div class="chart-container mt-6">
            <canvas id="energyChart"></canvas>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            4. Các Hệ Dao Động Cơ Học
          </h3>
          <div class="grid md:grid-cols-2 gap-8 mt-4 items-start">
            <div class="text-center">
              <h4 class="text-lg font-semibold mb-2 text-emerald-700">
                Con lắc lò xo
              </h4>
              <div class="spring-container">
                <div class="spring-support"></div>
                <div class="spring-coil"></div>
                <div class="spring-mass">m</div>
              </div>

              <div class="formula-card mt-2">
                <p>Thế năng đàn hồi: $W_t = \frac{1}{2}kx^2$</p>
                <br />
                <p>$\omega = \sqrt{\frac{k}{m}}$</p>
                <br />
                <p>$T = 2\pi\sqrt{\frac{m}{k}}$</p>
                <br />
                <p>$W = \frac{1}{2}kA^2$</p>
              </div>
            </div>
            <div class="text-center">
              <h4 class="text-lg font-semibold mb-2 text-sky-700">
                Con lắc đơn
              </h4>
              <div class="pendulum-container">
                <div class="pendulum-pivot"></div>
                <div class="pendulum-rod"><div class="pendulum-bob"></div></div>
              </div>
              <div class="formula-card mt-2">
                <p>Thế năng trọng trường: $W_t = mgl(1 - \cos\alpha)$</p>
                <br />
                <p>$\omega = \sqrt{\frac{g}{l}}$ (với góc lệch nhỏ)</p>
                <br />
                <p>$T = 2\pi\sqrt{\frac{l}{g}}$</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bài 6: Các loại dao động khác -->
      <section id="lesson-6" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 6: Dao Động Tắt Dần, Cưỡng Bức và Cộng Hưởng
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Đồ thị các loại dao động
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="mb-4 text-slate-600">
                Trong thực tế, dao động chịu ảnh hưởng của lực cản và có thể
                chịu tác dụng của ngoại lực.
              </p>
              <div
                class="flex justify-center space-x-2 md:space-x-4 mb-4 flex-wrap"
              >
                <button
                  id="btn-free"
                  class="px-3 py-1.5 text-sm bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition"
                >
                  Tự do
                </button>
                <button
                  id="btn-damped"
                  class="px-3 py-1.5 text-sm bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition"
                >
                  Tắt dần
                </button>
                <button
                  id="btn-forced"
                  class="px-3 py-1.5 text-sm bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition"
                >
                  Cưỡng bức
                </button>
              </div>
              <div
                id="oscillation-description"
                class="mt-4 p-3 bg-slate-50 rounded-lg text-slate-700 text-sm min-h-[80px]"
              >
                <!-- Description will be loaded by JS -->
              </div>
            </div>
            <div class="chart-container h-64">
              <canvas id="oscillationTypeChart"></canvas>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Hiện Tượng Cộng Hưởng
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="text-slate-600 mb-4">
                Là hiện tượng biên độ dao động cưỡng bức tăng đến giá trị cực
                đại khi tần số của lực cưỡng bức ($f$) tiến đến bằng tần số dao
                động riêng ($f_0$) của hệ. Lực cản càng nhỏ, đỉnh cộng hưởng
                càng nhọn và cao.
              </p>
              <div class="formula-card text-center">
                Điều kiện cộng hưởng: $f = f_0$
              </div>
            </div>
            <div class="chart-container h-64">
              <canvas id="resonanceChart"></canvas>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Ứng Dụng và Tác Hại của Cộng Hưởng
          </h3>
          <div class="mt-4 grid md:grid-cols-2 gap-6">
            <div
              class="bg-emerald-50 border-l-4 border-emerald-500 p-4 rounded"
            >
              <h4 class="font-bold text-emerald-800">Có Lợi</h4>
              <p class="text-sm">
                Hộp đàn guitar, violon (khuếch đại âm), mạch chọn sóng trong
                radio, TV, lò vi sóng.
              </p>
              <img
                src="https://placehold.co/400x200/a7f3d0/14532d?text=Hộp+đàn+Guitar"
                alt="Hộp đàn guitar"
                class="mt-3 rounded-lg w-full object-cover h-32"
              />
            </div>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
              <h4 class="font-bold text-red-800">Có Hại</h4>
              <p class="text-sm">
                Cầu, tòa nhà, bệ máy có thể sụp đổ nếu tần số của ngoại lực
                (gió, động cơ...) trùng tần số riêng.
              </p>
              <img
                src="https://placehold.co/400x200/fee2e2/7f1d1d?text=Sập+cầu+Tacoma"
                alt="Sập cầu Tacoma"
                class="mt-3 rounded-lg w-full object-cover h-32"
              />
            </div>
          </div>
        </div>
      </section>

      <!-- Mô phỏng -->
      <section id="simulations" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Thí Nghiệm Tương Tác
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Thí Nghiệm Tổng Hợp
          </h3>
          <p class="mb-8 text-slate-600">
            Thay đổi các thông số của một dao động điều hoà để quan sát sự thay
            đổi trên đồ thị li độ, vận tốc, gia tốc và năng lượng.
          </p>
          <div class="grid lg:grid-cols-3 gap-6">
            <!-- Controls -->
            <div class="lg:col-span-1 space-y-4">
              <h4 class="text-lg font-semibold text-slate-700">
                Bảng điều khiển
              </h4>
              <div>
                <label for="amplitude" class="block font-medium mb-1"
                  >Biên độ A (cm)</label
                >
                <input
                  type="range"
                  id="amplitude"
                  min="1"
                  max="10"
                  value="5"
                  step="0.5"
                  class="w-full"
                />
                <p class="text-center mt-1">
                  A = <span id="amplitudeValue">5.0</span> cm
                </p>
              </div>
              <div>
                <label for="omega" class="block font-medium mb-1"
                  >Tần số góc $\omega$ (rad/s)</label
                >
                <input
                  type="range"
                  id="omega"
                  min="0.5"
                  max="5"
                  value="2"
                  step="0.1"
                  class="w-full"
                />
                <p class="text-center mt-1">
                  $\omega$ = <span id="omegaValue">2.0</span> rad/s
                </p>
              </div>
              <div>
                <label for="phi" class="block font-medium mb-1"
                  >Pha ban đầu $\phi$ ($\times \pi$ rad)</label
                >
                <input
                  type="range"
                  id="phi"
                  min="-1"
                  max="1"
                  value="0"
                  step="0.1"
                  class="w-full"
                />
                <p class="text-center mt-1">
                  $\phi$ = <span id="phiValue">0.00</span>$\pi$ rad
                </p>
              </div>

              <h4 class="font-semibold pt-2">Hiển thị đồ thị</h4>
              <div class="space-y-2">
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showX"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                    checked
                  />
                  <label
                    for="showX"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Li độ (x)</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showV"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                    checked
                  />
                  <label
                    for="showV"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Vận tốc (v)</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showA"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                    checked
                  />
                  <label
                    for="showA"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Gia tốc (a)</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showEnergy"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                  />
                  <label
                    for="showEnergy"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Năng lượng (W, Wđ, Wt)</label
                  >
                </div>
              </div>
            </div>
            <!-- Chart and Animation -->
            <div class="lg:col-span-2">
              <div class="relative w-full aspect-[4/3] max-h-[500px]">
                <canvas id="interactiveChart"></canvas>
              </div>
              <div class="mt-4">
                <h4 class="text-center font-semibold">Mô phỏng vật</h4>
                <canvas
                  id="massAnimation"
                  height="80"
                  class="w-full bg-slate-50 rounded-lg mt-2"
                ></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Tương Tác: Khảo Sát Độ Lệch Pha
          </h3>
          <p class="mb-4 text-slate-600">
            Sử dụng các thanh trượt để thay đổi pha ban đầu của hai dao động và
            quan sát sự thay đổi trên đồ thị cũng như giá trị độ lệch pha.
          </p>
          <div class="chart-container">
            <canvas id="phaseShiftChart"></canvas>
          </div>
          <div class="grid md:grid-cols-2 gap-6 mt-6">
            <div>
              <label for="phi1" class="block font-medium mb-1"
                >Pha ban đầu $\phi_1$ ($ \times\pi$ rad)</label
              >
              <input
                type="range"
                id="phi1"
                min="-1"
                max="1"
                value="0"
                step="0.1"
                class="w-full"
              />
              <p class="text-center mt-1">
                $\phi_1 = $ <span id="phi1Value">0.00</span>$\pi$ rad
              </p>
            </div>
            <div>
              <label for="phi2" class="block font-medium mb-1"
                >Pha ban đầu $\phi_2$ ($ \times\pi$ rad)</label
              >
              <input
                type="range"
                id="phi2"
                min="-1"
                max="1"
                value="0.5"
                step="0.1"
                class="w-full"
              />
              <p class="text-center mt-1">
                $\phi_2 = $ <span id="phi2Value">0.50</span>$\pi$ rad
              </p>
            </div>
          </div>
          <div
            class="mt-4 text-center text-lg font-semibold bg-sky-100 text-sky-800 p-3 rounded-md"
          >
            Độ lệch pha $\Delta\phi = $
            <span id="deltaPhiValue">0.50</span>$\pi$ rad
          </div>
        </div>
      </section>

      <!-- Bài Tập -->
      <section id="exercises" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-6">
          Bài Tập Củng Cố Kiến Thức
        </h2>

        <div id="quiz-container" class="concept-card">
          <!-- Question 1 -->
          <div class="quiz-question" id="question-1">
            <p class="font-semibold mb-3">
              Câu 1: Trong dao động điều hoà, gia tốc $a$ và li độ $x$ liên hệ
              với nhau bằng hệ thức nào sau đây?
            </p>
            <div class="quiz-options">
              <input type="radio" name="q1" id="q1a" value="A" /><label
                for="q1a"
                >A. $a = \omega x$</label
              >
              <input type="radio" name="q1" id="q1b" value="B" /><label
                for="q1b"
                >B. $a = -\omega^2 x$</label
              >
              <input type="radio" name="q1" id="q1c" value="C" /><label
                for="q1c"
                >C. $a = -\omega x$</label
              >
              <input type="radio" name="q1" id="q1d" value="D" /><label
                for="q1d"
                >D. $a = \omega^2 x$</label
              >
            </div>
            <div class="explanation" id="explanation-1"></div>
          </div>

          <!-- Question 2 -->
          <div class="quiz-question" id="question-2">
            <p class="font-semibold mb-3">
              Câu 2: Một vật dao động điều hoà có đồ thị li độ theo thời gian
              như hình vẽ. Biên độ và chu kì dao động của vật là bao nhiêu?
            </p>
            <div
              class="chart-container"
              style="height: 250px; margin-bottom: 1rem"
            >
              <canvas id="quiz-graph-1"></canvas>
            </div>
            <div class="quiz-options">
              <input type="radio" name="q2" id="q2a" value="A" /><label
                for="q2a"
                >A. A = 5 cm, T = 2 s</label
              >
              <input type="radio" name="q2" id="q2b" value="B" /><label
                for="q2b"
                >B. A = 10 cm, T = 4 s</label
              >
              <input type="radio" name="q2" id="q2c" value="C" /><label
                for="q2c"
                >C. A = 5 cm, T = 4 s</label
              >
              <input type="radio" name="q2" id="q2d" value="D" /><label
                for="q2d"
                >D. A = 10 cm, T = 2 s</label
              >
            </div>
            <div class="explanation" id="explanation-2"></div>
          </div>

          <!-- Question 3 -->
          <div class="quiz-question" id="question-3">
            <p class="font-semibold mb-3">
              Câu 3: Khi một vật dao động điều hoà di chuyển từ vị trí cân bằng
              ra vị trí biên, thì:
            </p>
            <div class="quiz-options">
              <input type="radio" name="q3" id="q3a" value="A" /><label
                for="q3a"
                >A. Động năng tăng, thế năng giảm.</label
              >
              <input type="radio" name="q3" id="q3b" value="B" /><label
                for="q3b"
                >B. Động năng và thế năng cùng tăng.</label
              >
              <input type="radio" name="q3" id="q3c" value="C" /><label
                for="q3c"
                >C. Động năng giảm, thế năng tăng.</label
              >
              <input type="radio" name="q3" id="q3d" value="D" /><label
                for="q3d"
                >D. Động năng và thế năng cùng giảm.</label
              >
            </div>
            <div class="explanation" id="explanation-3"></div>
          </div>

          <!-- Question 4 -->
          <div class="quiz-question" id="question-4">
            <p class="font-semibold mb-3">
              Câu 4: Chu kì dao động của con lắc đơn có chiều dài $l$ tại nơi có
              gia tốc trọng trường $g$ được xác định bởi công thức nào?
            </p>
            <div class="quiz-options">
              <input type="radio" name="q4" id="q4a" value="A" /><label
                for="q4a"
                >A. $T = 2\pi\sqrt{\frac{m}{k}}$</label
              >
              <input type="radio" name="q4" id="q4b" value="B" /><label
                for="q4b"
                >B. $T = \frac{1}{2\pi}\sqrt{\frac{g}{l}}$</label
              >
              <input type="radio" name="q4" id="q4c" value="C" /><label
                for="q4c"
                >C. $T = 2\pi\sqrt{\frac{k}{m}}$</label
              >
              <input type="radio" name="q4" id="q4d" value="D" /><label
                for="q4d"
                >D. $T = 2\pi\sqrt{\frac{l}{g}}$</label
              >
            </div>
            <div class="explanation" id="explanation-4"></div>
          </div>

          <!-- Question 5 -->
          <div class="quiz-question" id="question-5">
            <p class="font-semibold mb-3">
              Câu 5: Đồ thị dưới đây biểu diễn hai dao động điều hoà (1) và (2).
              Nhận xét nào sau đây về độ lệch pha giữa hai dao động là đúng?
            </p>
            <div
              class="chart-container"
              style="height: 250px; margin-bottom: 1rem"
            >
              <canvas id="quiz-graph-2"></canvas>
            </div>
            <div class="quiz-options">
              <input type="radio" name="q5" id="q5a" value="A" /><label
                for="q5a"
                >A. Dao động (1) sớm pha hơn dao động (2) một góc
                $\frac{\pi}{2}$.</label
              >
              <input type="radio" name="q5" id="q5b" value="B" /><label
                for="q5b"
                >B. Dao động (1) trễ pha hơn dao động (2) một góc
                $\frac{\pi}{2}$.</label
              >
              <input type="radio" name="q5" id="q5c" value="C" /><label
                for="q5c"
                >C. Hai dao động cùng pha.</label
              >
              <input type="radio" name="q5" id="q5d" value="D" /><label
                for="q5d"
                >D. Hai dao động ngược pha.</label
              >
            </div>
            <div class="explanation" id="explanation-5"></div>
          </div>

          <div class="text-center mt-8">
            <button
              id="check-quiz-btn"
              class="bg-sky-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-sky-700 transition-colors duration-300"
            >
              Kiểm Tra Đáp Án
            </button>
            <div id="quiz-result" class="mt-6 text-xl font-bold"></div>
          </div>
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const navButtons = document.querySelectorAll(".nav-btn");
        const contentSections = document.querySelectorAll(".content-section");
        let activeCharts = {};
        let animationFrames = {};

        const cancelAllAnimations = () => {
          Object.values(animationFrames).forEach((id) =>
            cancelAnimationFrame(id)
          );
          animationFrames = {};
        };

        renderMathInElement(document.body, {
          delimiters: [
            { left: "$$", right: "$$", display: true },
            { left: "$", right: "$", display: false },
          ],
          throwOnError: false,
        });

        function switchTab(targetId) {
          cancelAllAnimations();
          Object.values(activeCharts).forEach((chart) => {
            if (chart && typeof chart.destroy === "function") {
              chart.destroy();
            }
          });
          activeCharts = {};

          contentSections.forEach((section) =>
            section.classList.remove("active")
          );
          navButtons.forEach((button) => button.classList.remove("active"));

          const targetSection = document.getElementById(targetId);
          const targetButton = document.querySelector(
            `[data-target="${targetId}"]`
          );

          if (targetSection) targetSection.classList.add("active");
          if (targetButton) targetButton.classList.add("active");

          initializeForTab(targetId);
        }

        navButtons.forEach((button) => {
          button.addEventListener("click", () =>
            switchTab(button.getAttribute("data-target"))
          );
        });

        function initializeForTab(targetId) {
          switch (targetId) {
            case "lesson-1-2":
              createBasicOscillationAnimation();
              createShmGraph();
              createCircularMotionAnimation();
              createPhaseCharts();
              break;
            case "lesson-3-5":
              createVectorAnimation();
              createEnergyBarAnimation();
              createXvaChart();
              createEnergyChart();
              break;
            case "lesson-6":
              createOscillationTypeChart();
              createResonanceChart();
              break;
            case "simulations":
              setupComprehensiveSimulation();
              createPhaseShiftChart();
              break;
            case "exercises":
              initializeQuiz();
              break;
          }
        }

        const chartDefaultOptions = {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: "index", intersect: false },
          plugins: { legend: { position: "top" } },
        };

        function createBasicOscillationAnimation() {
          const canvas = document.getElementById("basic-oscillation-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height;
            const centerY = h / 2,
              amplitude = w / 2 - 20;
            const x = w / 2 + amplitude * Math.cos(time / 500);
            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.moveTo(w / 2, 0);
            ctx.lineTo(w / 2, h);
            ctx.strokeStyle = "#cbd5e1";
            ctx.setLineDash([5, 3]);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.arc(x, centerY, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "#0ea5e9";
            ctx.fill();
            animationFrames.basic = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createShmGraph() {
          const ctx = document.getElementById("shmGraph")?.getContext("2d");
          if (!ctx) return;
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.25).toFixed(2)
          );
          activeCharts.shm = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Li độ x (cm)",
                  data: labels.map((t) => 10 * Math.cos((Math.PI / 2) * t)),
                  borderColor: "#38bdf8",
                  backgroundColor: "rgba(56, 189, 248, 0.1)",
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: { title: { display: true, text: "t(s)" } },
                y: { title: { display: true, text: "x(cm)" } },
              },
            },
          });
        }

        function createCircularMotionAnimation() {
          const canvas = document.getElementById("circular-motion-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height;
            const centerX = w / 2,
              centerY = h / 2,
              radius = w / 2 - 20;
            const angle = time / 1000;
            const mX = centerX + radius * Math.cos(angle);
            const mY = centerY - radius * Math.sin(angle); // Use minus for conventional angle direction
            const pX = mX;
            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = "#e2e8f0";
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, h);
            ctx.strokeStyle = "#cbd5e1";
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(mX, mY);
            ctx.lineTo(pX, centerY);
            ctx.strokeStyle = "#cbd5e1";
            ctx.setLineDash([3, 3]);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.arc(mX, mY, 6, 0, 2 * Math.PI);
            ctx.fillStyle = "#f97316";
            ctx.fill();
            ctx.beginPath();
            ctx.arc(pX, centerY, 8, 0, 2 * Math.PI);
            ctx.fillStyle = "#0ea5e9";
            ctx.fill();
            animationFrames.circular = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createVectorAnimation() {
          const canvas = document.getElementById("vector-animation-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height,
              centerY = h / 2 + 20,
              amplitude = w / 2 - 40;
            const omega = 2;
            const t = time / 1000;
            const x_norm = Math.cos(omega * t);
            const v_norm = -Math.sin(omega * t);
            const a_norm = -Math.cos(omega * t);
            const x_pos = w / 2 + x_norm * amplitude;

            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.moveTo(w / 2, 0);
            ctx.lineTo(w / 2, h);
            ctx.strokeStyle = "#cbd5e1";
            ctx.setLineDash([5, 3]);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.beginPath();
            ctx.moveTo(x_pos, centerY);
            ctx.lineTo(x_pos + v_norm * 30, centerY);
            ctx.strokeStyle = "#10b981";
            ctx.lineWidth = 3;
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x_pos, centerY + 20);
            ctx.lineTo(x_pos + a_norm * 40, centerY + 20);
            ctx.strokeStyle = "#f97316";
            ctx.lineWidth = 3;
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x_pos, centerY, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "#0ea5e9";
            ctx.fill();
            animationFrames.vector = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createEnergyBarAnimation() {
          const canvas = document.getElementById("energy-bar-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height,
              barWidth = 40,
              maxH = h - 20;
            const t = time / 1000;
            const Wt_norm = Math.pow(Math.cos(t * 2), 2);
            const Wd_norm = Math.pow(Math.sin(t * 2), 2);
            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = "rgba(56, 189, 248, 0.7)";
            ctx.fillRect(
              w / 2 - barWidth - 10,
              maxH * (1 - Wt_norm) + 10,
              barWidth,
              maxH * Wt_norm
            );
            ctx.fillStyle = "rgba(16, 185, 129, 0.7)";
            ctx.fillRect(
              w / 2 + 10,
              maxH * (1 - Wd_norm) + 10,
              barWidth,
              maxH * Wd_norm
            );
            ctx.strokeStyle = "#ef4444";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(w / 2 - barWidth - 20, 10);
            ctx.lineTo(w / 2 + barWidth + 20, 10);
            ctx.stroke();
            ctx.fillStyle = "#334155";
            ctx.font = "12px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("Wt", w / 2 - barWidth / 2 - 10, h - 5);
            ctx.fillText("Wd", w / 2 + barWidth / 2 + 10, h - 5);
            animationFrames.energy = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createXvaChart() {
          const ctx = document.getElementById("xvaChart")?.getContext("2d");
          if (!ctx) return;
          const A = 5,
            omega = Math.PI;
          const labels = Array.from({ length: 41 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          activeCharts.xva = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Li độ x (cm)",
                  data: labels.map((t) => A * Math.cos(omega * t)),
                  borderColor: "#38bdf8",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y",
                },
                {
                  label: "Vận tốc v (cm/s)",
                  data: labels.map((t) => -A * omega * Math.sin(omega * t)),
                  borderColor: "#10b981",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y1",
                },
                {
                  label: "Gia tốc a (cm/s²)",
                  data: labels.map(
                    (t) => -A * omega * omega * Math.cos(omega * t)
                  ),
                  borderColor: "#f97316",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y2",
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: { title: { display: true, text: "Thời gian (s)" } },
                y: {
                  type: "linear",
                  display: true,
                  position: "left",
                  title: { display: true, text: "Li độ (cm)" },
                },
                y1: {
                  type: "linear",
                  display: true,
                  position: "right",
                  grid: { drawOnChartArea: false },
                  title: { display: true, text: "Vận tốc (cm/s)" },
                },
                y2: { display: false },
              },
            },
          });
        }

        function createEnergyChart() {
          const ctx = document.getElementById("energyChart")?.getContext("2d");
          if (!ctx) return;
          const W = 1;
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.1 * Math.PI).toFixed(2)
          );
          activeCharts.energy = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Động năng (Wđ)",
                  data: labels.map((t) => W * Math.pow(Math.sin(2 * t), 2)),
                  backgroundColor: "rgba(16, 185, 129, 0.5)",
                  borderColor: "#10b981",
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Thế năng (Wt)",
                  data: labels.map((t) => W * Math.pow(Math.cos(2 * t), 2)),
                  backgroundColor: "rgba(56, 189, 248, 0.5)",
                  borderColor: "#38bdf8",
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Cơ năng (W)",
                  data: labels.map(() => W),
                  borderColor: "#ef4444",
                  fill: false,
                  borderWidth: 3,
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                y: {
                  beginAtZero: true,
                  stacked: true,
                  title: { display: true, text: "Năng lượng (J)" },
                },
                x: { title: { display: true, text: "Pha dao động (rad)" } },
              },
            },
          });
        }

        function createPhaseCharts() {
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          const data1 = labels.map((t) => 10 * Math.cos(2 * Math.PI * t));
          const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { ticks: { display: false }, grid: { display: false } },
              y: { ticks: { display: false }, grid: { display: false } },
            },
            elements: { line: { tension: 0.4, pointRadius: 0 } },
          };
          activeCharts.inPhase = new Chart(
            document.getElementById("inPhaseChart")?.getContext("2d"),
            {
              type: "line",
              data: {
                labels,
                datasets: [
                  { data: data1, borderColor: "#38bdf8" },
                  {
                    data: labels.map((t) => 10 * Math.cos(2 * Math.PI * t)),
                    borderColor: "#10b981",
                    borderDash: [5, 5],
                  },
                ],
              },
              options: commonOptions,
            }
          );
          activeCharts.outPhase = new Chart(
            document.getElementById("outOfPhaseChart")?.getContext("2d"),
            {
              type: "line",
              data: {
                labels,
                datasets: [
                  { data: data1, borderColor: "#38bdf8" },
                  {
                    data: labels.map(
                      (t) => 10 * Math.cos(2 * Math.PI * t + Math.PI)
                    ),
                    borderColor: "#f97316",
                    borderDash: [5, 5],
                  },
                ],
              },
              options: commonOptions,
            }
          );
          activeCharts.quadPhase = new Chart(
            document.getElementById("quadraturePhaseChart")?.getContext("2d"),
            {
              type: "line",
              data: {
                labels,
                datasets: [
                  { data: data1, borderColor: "#38bdf8" },
                  {
                    data: labels.map(
                      (t) => 10 * Math.cos(2 * Math.PI * t + Math.PI / 2)
                    ),
                    borderColor: "#a855f7",
                    borderDash: [5, 5],
                  },
                ],
              },
              options: commonOptions,
            }
          );
        }

        function createOscillationTypeChart() {
          const ctx = document
            .getElementById("oscillationTypeChart")
            ?.getContext("2d");
          if (!ctx) return;
          const descriptionDiv = document.getElementById(
            "oscillation-description"
          );
          const labels = Array.from({ length: 101 }, (_, i) =>
            (i * 0.2).toFixed(1)
          );
          const dataSets = {
            free: {
              label: "Dao động tự do",
              data: labels.map((t) => 10 * Math.cos(2 * Math.PI * t)),
              borderColor: "#0ea5e9",
              description: `<h4 class="font-semibold">Dao động Tự do</h4><p>Biên độ và tần số không đổi (lí tưởng).</p>`,
            },
            damped: {
              label: "Dao động tắt dần",
              data: labels.map(
                (t) => 10 * Math.exp(-0.15 * t) * Math.cos(2 * Math.PI * t)
              ),
              borderColor: "#f59e0b",
              description: `<h4 class="font-semibold">Dao động Tắt dần</h4><p>Biên độ giảm dần do lực cản.</p>`,
            },
            forced: {
              label: "Dao động cưỡng bức",
              data: labels.map((t) => 8 * Math.cos(1.8 * Math.PI * t)),
              borderColor: "#10b981",
              description: `<h4 class="font-semibold">Dao động Cưỡng bức</h4><p>Tần số theo ngoại lực, biên độ không đổi.</p>`,
            },
          };
          const chart = new Chart(ctx, {
            type: "line",
            data: { labels: labels, datasets: [dataSets.free] },
            options: {
              ...chartDefaultOptions,
              scales: { y: { min: -12, max: 12 } },
            },
          });
          activeCharts.oscTypes = chart;
          descriptionDiv.innerHTML = dataSets.free.description;
          document.getElementById("btn-free").addEventListener("click", () => {
            chart.data.datasets = [dataSets.free];
            chart.update();
            descriptionDiv.innerHTML = dataSets.free.description;
          });
          document
            .getElementById("btn-damped")
            .addEventListener("click", () => {
              chart.data.datasets = [dataSets.damped];
              chart.update();
              descriptionDiv.innerHTML = dataSets.damped.description;
            });
          document
            .getElementById("btn-forced")
            .addEventListener("click", () => {
              chart.data.datasets = [dataSets.forced];
              chart.update();
              descriptionDiv.innerHTML = dataSets.forced.description;
            });
        }

        function createResonanceChart() {
          const ctx = document
            .getElementById("resonanceChart")
            ?.getContext("2d");
          if (!ctx) return;
          const f0 = 5.0;
          const createResonanceData = (damping) => {
            let data = [];
            for (let f = 0; f <= 10; f += 0.2) {
              const amplitude =
                1 / Math.sqrt(Math.pow(f * f - f0 * f0, 2) + damping * f * f);
              data.push({ x: f, y: amplitude });
            }
            return data;
          };
          activeCharts.resonance = new Chart(ctx, {
            type: "line",
            data: {
              datasets: [
                {
                  label: "Lực cản nhỏ",
                  data: createResonanceData(1),
                  borderColor: "#ef4444",
                  tension: 0.4,
                  fill: false,
                },
                {
                  label: "Lực cản trung bình",
                  data: createResonanceData(10),
                  borderColor: "#f97316",
                  tension: 0.4,
                  fill: false,
                },
                {
                  label: "Lực cản lớn",
                  data: createResonanceData(50),
                  borderColor: "#f59e0b",
                  tension: 0.4,
                  fill: false,
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: {
                  type: "linear",
                  position: "bottom",
                  title: { display: true, text: "Tần số ngoại lực f (Hz)" },
                },
                y: { title: { display: true, text: "Biên độ A" } },
              },
            },
          });
        }

        function setupComprehensiveSimulation() {
          const controls = {
            amp: document.getElementById("amplitude"),
            omega: document.getElementById("omega"),
            phi: document.getElementById("phi"),
            showX: document.getElementById("showX"),
            showV: document.getElementById("showV"),
            showA: document.getElementById("showA"),
            showEnergy: document.getElementById("showEnergy"),
          };
          const values = {
            amp: document.getElementById("amplitudeValue"),
            omega: document.getElementById("omegaValue"),
            phi: document.getElementById("phiValue"),
          };
          const chartCtx = document
            .getElementById("interactiveChart")
            .getContext("2d");
          const animCanvas = document.getElementById("massAnimation");
          const animCtx = animCanvas.getContext("2d");
          const time = Array.from({ length: 101 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          const interactiveChart = new Chart(chartCtx, {
            type: "line",
            data: { labels: time, datasets: [] },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: { title: { display: true, text: "Thời gian t (s)" } },
                y: {
                  type: "linear",
                  position: "left",
                  title: { display: true, text: "x, v, a" },
                },
                yEnergy: {
                  type: "linear",
                  position: "right",
                  grid: { drawOnChartArea: false },
                  title: { display: true, text: "Năng lượng" },
                },
              },
            },
          });
          activeCharts.sim = interactiveChart;
          function updateSimulation() {
            const A = parseFloat(controls.amp.value),
              w = parseFloat(controls.omega.value),
              p = parseFloat(controls.phi.value) * Math.PI,
              m = 0.5,
              k = m * w * w,
              W = 0.5 * k * A * A;
            values.amp.textContent = A.toFixed(1);
            values.omega.textContent = w.toFixed(1);
            values.phi.textContent = (p / Math.PI).toFixed(2);
            const datasets = [];
            if (controls.showX.checked)
              datasets.push({
                label: "Li độ x (cm)",
                data: time.map((t) => A * Math.cos(w * t + p)),
                borderColor: "#38bdf8",
                yAxisID: "y",
                pointRadius: 0,
              });
            if (controls.showV.checked)
              datasets.push({
                label: "Vận tốc v (cm/s)",
                data: time.map((t) => -A * w * Math.sin(w * t + p)),
                borderColor: "#10b981",
                yAxisID: "y",
                pointRadius: 0,
              });
            if (controls.showA.checked)
              datasets.push({
                label: "Gia tốc a (cm/s²)",
                data: time.map((t) => -A * w * w * Math.cos(w * t + p)),
                borderColor: "#f97316",
                yAxisID: "y",
                pointRadius: 0,
              });
            if (controls.showEnergy.checked) {
              datasets.push({
                label: "Động năng Wđ",
                data: time.map(
                  (t) => 0.5 * m * Math.pow(-A * w * Math.sin(w * t + p), 2)
                ),
                borderColor: "#10b981",
                backgroundColor: "rgba(16, 185, 129, 0.2)",
                fill: true,
                yAxisID: "yEnergy",
                pointRadius: 0,
              });
              datasets.push({
                label: "Thế năng Wt",
                data: time.map(
                  (t) => 0.5 * k * Math.pow(A * Math.cos(w * t + p), 2)
                ),
                borderColor: "#38bdf8",
                backgroundColor: "rgba(56, 189, 248, 0.2)",
                fill: true,
                yAxisID: "yEnergy",
                pointRadius: 0,
              });
              datasets.push({
                label: "Cơ năng W",
                data: time.map(() => W),
                borderColor: "#ef4444",
                borderWidth: 3,
                yAxisID: "yEnergy",
                pointRadius: 0,
              });
            }
            interactiveChart.data.datasets = datasets;
            interactiveChart.update();
            if (animationFrames.sim) cancelAnimationFrame(animationFrames.sim);
            window.startTime = performance.now();
            animateMass(window.startTime);
          }
          function animateMass(timestamp) {
            const A_val = parseFloat(controls.amp.value),
              w_val = parseFloat(controls.omega.value),
              p_val = parseFloat(controls.phi.value) * Math.PI;
            const elapsed = (timestamp - window.startTime) / 1000;
            const canvasW = animCanvas.width,
              canvasH = animCanvas.height,
              centerY = canvasH / 2,
              animAmplitude = canvasW / 2 - 20;
            const x_pos = A_val * Math.cos(w_val * elapsed + p_val);
            const screen_x = canvasW / 2 + (x_pos / 10) * animAmplitude;
            animCtx.clearRect(0, 0, canvasW, canvasH);
            animCtx.beginPath();
            animCtx.moveTo(canvasW / 2, 0);
            animCtx.lineTo(canvasW / 2, canvasH);
            animCtx.strokeStyle = "#cbd5e1";
            animCtx.setLineDash([5, 5]);
            animCtx.stroke();
            animCtx.setLineDash([]);
            animCtx.beginPath();
            animCtx.arc(screen_x, centerY, 10, 0, 2 * Math.PI);
            animCtx.fillStyle = "#0ea5e9";
            animCtx.fill();
            animationFrames.sim = requestAnimationFrame(animateMass);
          }
          Object.values(controls).forEach((el) =>
            el.addEventListener("input", updateSimulation)
          );
          updateSimulation();
        }

        function createPhaseShiftChart() {
          const ctx = document
            .getElementById("phaseShiftChart")
            ?.getContext("2d");
          if (!ctx) return;
          const phi1Slider = document.getElementById("phi1"),
            phi2Slider = document.getElementById("phi2");
          const phi1Value = document.getElementById("phi1Value"),
            phi2Value = document.getElementById("phi2Value");
          const deltaPhiValue = document.getElementById("deltaPhiValue");
          const labels = Array.from({ length: 101 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          function getWaveData(phi) {
            return labels.map(
              (t) => 10 * Math.cos(Math.PI * t + phi * Math.PI)
            );
          }
          const chart = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Dao động 1",
                  data: getWaveData(parseFloat(phi1Slider.value)),
                  borderColor: "#38bdf8",
                  borderWidth: 2,
                  pointRadius: 0,
                },
                {
                  label: "Dao động 2",
                  data: getWaveData(parseFloat(phi2Slider.value)),
                  borderColor: "#10b981",
                  borderWidth: 2,
                  pointRadius: 0,
                  borderDash: [5, 5],
                },
              ],
            },
            options: chartDefaultOptions,
          });
          activeCharts.phaseShift = chart;
          function updateChart() {
            const phi1 = parseFloat(phi1Slider.value),
              phi2 = parseFloat(phi2Slider.value);
            phi1Value.textContent = phi1.toFixed(2);
            phi2Value.textContent = phi2.toFixed(2);
            deltaPhiValue.textContent = (phi2 - phi1).toFixed(2);
            chart.data.datasets[0].data = getWaveData(phi1);
            chart.data.datasets[1].data = getWaveData(phi2);
            chart.update();
          }
          phi1Slider.addEventListener("input", updateChart);
          phi2Slider.addEventListener("input", updateChart);
          updateChart();
        }

        // --- Quiz Logic ---
        function initializeQuiz() {
          renderMathInElement(document.getElementById("exercises"));
          // Graph for Question 2
          const ctx1 = document
            .getElementById("quiz-graph-1")
            ?.getContext("2d");
          if (ctx1) {
            const labels = Array.from({ length: 41 }, (_, i) =>
              (i * 0.1).toFixed(1)
            );
            activeCharts.quiz1 = new Chart(ctx1, {
              type: "line",
              data: {
                labels: labels,
                datasets: [
                  {
                    label: "Li độ x (cm)",
                    data: labels.map((t) => 5 * Math.cos((Math.PI / 2) * t)),
                    borderColor: "#38bdf8",
                    tension: 0.1,
                    pointRadius: 0,
                  },
                ],
              },
              options: {
                ...chartDefaultOptions,
                scales: {
                  x: { title: { display: true, text: "t(s)" } },
                  y: { title: { display: true, text: "x(cm)" } },
                },
              },
            });
          }

          // Graph for Question 5
          const ctx2 = document
            .getElementById("quiz-graph-2")
            ?.getContext("2d");
          if (ctx2) {
            const labels = Array.from({ length: 41 }, (_, i) =>
              (i * 0.1).toFixed(1)
            );
            activeCharts.quiz2 = new Chart(ctx2, {
              type: "line",
              data: {
                labels: labels,
                datasets: [
                  {
                    label: "Dao động (1)",
                    data: labels.map((t) => 8 * Math.cos(Math.PI * t)),
                    borderColor: "#38bdf8",
                    tension: 0.1,
                    pointRadius: 0,
                  },
                  {
                    label: "Dao động (2)",
                    data: labels.map((t) => 8 * Math.sin(Math.PI * t)), // sin(x) = cos(x - pi/2)
                    borderColor: "#10b981",
                    borderDash: [5, 5],
                    tension: 0.1,
                    pointRadius: 0,
                  },
                ],
              },
              options: {
                ...chartDefaultOptions,
                scales: {
                  x: { title: { display: true, text: "t(s)" } },
                  y: { title: { display: true, text: "x(cm)" } },
                },
              },
            });
          }

          const checkButton = document.getElementById("check-quiz-btn");
          if (checkButton) {
            // Remove existing listener to avoid duplicates on tab switch
            const newButton = checkButton.cloneNode(true);
            checkButton.parentNode.replaceChild(newButton, checkButton);
            newButton.addEventListener("click", checkQuizAnswers);
          }
        }

        function checkQuizAnswers() {
          const answers = {
            q1: "B",
            q2: "C",
            q3: "C",
            q4: "D",
            q5: "A",
          };
          const explanations = {
            q1: `Gia tốc trong DĐĐH luôn ngược pha và tỉ lệ với li độ theo công thức $a = -\\omega^2x$.`,
            q2: "Từ đồ thị, giá trị li độ cực đại là 5 cm, nên A = 5 cm. Vật thực hiện một dao động toàn phần (ví dụ từ đỉnh này đến đỉnh kia) mất 4 s, nên T = 4 s.",
            q3: "Khi đi từ VTCB ($x=0, v=v_{\\text{max}}, W_đ=W_{\\text{đ,max}}, W_t=0$) ra biên ($x=\\pm A, v=0, W_đ=0, W_t=W_{\\text{t,max}}$), vận tốc giảm nên động năng giảm, li độ tăng nên thế năng tăng.",
            q4: "Công thức tính chu kì con lắc đơn là $T = 2\\pi\\sqrt{\\frac{l}{g}}$. Công thức $T = 2\\pi\\sqrt{\\frac{m}{k}}$ là của con lắc lò xo.",
            q5: "Dao động (1) là hàm cos, đạt cực đại tại $t=0$. Dao động (2) là hàm sin, đi qua VTCB theo chiều dương tại $t=0$. Dao động (1) sớm pha hơn dao động (2) một góc $\\frac{\\pi}{2}$ (vì $\\cos(x) = \\sin(x + \\frac{\\pi}{2})$).",
          };
          let score = 0;
          const totalQuestions = Object.keys(answers).length;

          for (const qId in answers) {
            const questionNumber = qId.substring(1);
            const correctAnswer = answers[qId];
            const selectedOption = document.querySelector(
              `input[name="${qId}"]:checked`
            );

            const optionLabels = document.querySelectorAll(
              `#question-${questionNumber} .quiz-options label`
            );
            optionLabels.forEach((label) => {
              label.classList.remove("correct", "incorrect");
            });

            const explanationEl = document.getElementById(
              `explanation-${questionNumber}`
            );

            if (selectedOption) {
              const userAnswer = selectedOption.value;
              const userLabel = document.querySelector(
                `label[for="${selectedOption.id}"]`
              );
              const correctLabel = document.querySelector(
                `label[for="${qId}${correctAnswer.toLowerCase()}"]`
              );

              if (userAnswer === correctAnswer) {
                score++;
                userLabel.classList.add("correct");
                explanationEl.innerHTML = explanations[qId];
                explanationEl.className = "explanation correct";
              } else {
                userLabel.classList.add("incorrect");
                if (correctLabel) correctLabel.classList.add("correct");
                explanationEl.innerHTML = explanations[qId];
                explanationEl.className = "explanation incorrect";
              }
            } else {
              // No answer selected, mark the correct one
              const correctLabel = document.querySelector(
                `label[for="${qId}${correctAnswer.toLowerCase()}"]`
              );
              if (correctLabel) correctLabel.classList.add("correct");
              explanationEl.innerHTML =
                "Bạn chưa chọn đáp án. " + explanations[qId];
              explanationEl.className = "explanation incorrect";
            }
            renderMathInElement(explanationEl);
          }

          const resultEl = document.getElementById("quiz-result");
          resultEl.textContent = `Kết quả: Bạn đã trả lời đúng ${score}/${totalQuestions} câu!`;
        }

        // --- Initial Load ---
        switchTab("lesson-1-2");
      });
    </script>
  </body>
</html>
