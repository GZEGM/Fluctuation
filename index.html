<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vật Lý 11 - Chương 1: Dao Động</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <!-- KaTeX for beautiful math rendering -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      xintegrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
      crossorigin="anonymous"
    />
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"
      xintegrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0i8"
      crossorigin="anonymous"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"
      xintegrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05"
      crossorigin="anonymous"
    ></script>

    <style>
      body {
        font-family: "Be Vietnam Pro", sans-serif;
        background-color: #f8fafc; /* Slate 50 */
      }
      .nav-btn {
        transition: all 0.3s ease;
        border-bottom-width: 4px;
        border-color: transparent;
      }
      .nav-btn.active {
        border-color: #0ea5e9; /* Sky 500 */
        color: #0c4a6e; /* Sky 900 */
        background-color: #e0f2fe; /* Sky 100 */
      }
      .content-section {
        display: none;
      }
      .content-section.active {
        display: block;
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .formula-card {
        background-color: #f0f9ff; /* Sky 50 */
        border-left: 4px solid #38bdf8; /* Sky 400 */
        padding: 1rem;
        border-radius: 0.5rem;
      }
      .concept-card {
        background: white;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1),
          0 2px 4px -2px rgb(0 0 0 / 0.1);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      .chart-container {
        position: relative;
        width: 100%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        height: 350px;
      }
      /* Custom checkbox styles */
      .toggle-checkbox:checked {
        background-color: #0ea5e9;
        border-color: #0ea5e9;
      }
      .toggle-checkbox:checked + .toggle-label {
        color: #0c4a6e;
        font-weight: 600;
      }

      /* Animation for Simple Pendulum */
      .pendulum-container {
        position: relative;
        width: 150px;
        height: 200px;
        margin: 20px auto;
      }
      .pendulum-pivot {
        width: 20px;
        height: 10px;
        background: #475569; /* Slate 600 */
        border-radius: 5px;
        position: absolute;
        left: 50%;
        transform: translateX(-50%);
        z-index: 2;
      }
      .pendulum-rod {
        width: 2px;
        height: 150px;
        background: #64748b; /* Slate 500 */
        position: absolute;
        left: 50%;
        transform-origin: top center;
        animation: swing 4s ease-in-out infinite;
      }
      .pendulum-bob {
        width: 30px;
        height: 30px;
        background: #0ea5e9; /* Sky 500 */
        border-radius: 50%;
        position: absolute;
        bottom: -15px;
        left: -14px;
      }
      @keyframes swing {
        0%,
        100% {
          transform: rotate(45deg);
        }
        50% {
          transform: rotate(-45deg);
        }
      }

      /* Animation for Spring Pendulum */
      .spring-container {
        position: relative;
        width: 150px;
        height: 250px;
        margin: 20px auto;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      .spring-support {
        width: 100px;
        height: 10px;
        background: #475569; /* Slate 600 */
        border-radius: 5px;
      }
      .spring-mass {
        width: 50px;
        height: 50px;
        background: #10b981; /* Emerald 500 */
        border-radius: 8px;
        position: absolute;
        bottom: 0;
        left: 50px;
        animation: bounce 2s ease-in-out infinite;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
      }
      .spring-coil {
        width: 20px;
        height: 150px;
        border: 2px solid #64748b;
        border-bottom: none;
        border-radius: 10px 10px 0 0;
        position: absolute;
        top: 10px;
        left: 65px;
        transform-origin: top;
        animation: stretch 2s ease-in-out infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-100px);
        }
      }
      @keyframes stretch {
        0%,
        100% {
          height: 150px;
        }
        50% {
          height: 50px;
        }
      }

      /* Quiz styles */
      .quiz-question {
        margin-bottom: 2rem;
        padding-bottom: 1.5rem;
        border-bottom: 1px solid #e2e8f0; /* Slate 200 */
      }
      .quiz-question:last-of-type {
        border-bottom: none;
      }
      .quiz-options input:checked + label {
        background-color: #e0f2fe; /* Sky 100 */
        border-color: #38bdf8; /* Sky 400 */
        font-weight: 600;
        box-shadow: 0 0 0 2px #38bdf8;
      }
      .quiz-options label.correct {
        background-color: #dcfce7 !important; /* Green 100 */
        border-color: #22c55e !important; /* Green 500 */
      }
      .quiz-options label.incorrect {
        background-color: #fee2e2 !important; /* Red 100 */
        border-color: #ef4444 !important; /* Red 500 */
      }
      .explanation {
        margin-top: 0.75rem;
        padding: 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.9rem;
        display: none;
      }
      .explanation.correct {
        background-color: #f0fdf4; /* Green 50 */
        color: #15803d; /* Green 700 */
        display: block;
      }
      .explanation.incorrect {
        background-color: #fef2f2; /* Red 50 */
        color: #b91c1c; /* Red 700 */
        display: block;
      }
      /* Styles for multiple-true-false */
      .statement-item input:checked + label {
        background-color: #e0f2fe; /* Sky 100 */
        border-color: #38bdf8; /* Sky 400 */
      }
    </style>
  </head>
  <body class="text-slate-800">
    <header class="bg-white shadow-md sticky top-0 z-10">
      <div class="container mx-auto px-4 py-4">
        <h1 class="text-2xl md:text-3xl font-bold text-sky-800">
          Chương I: Dao Động
        </h1>
        <p class="text-slate-600 mt-1">
          Khám phá các khái niệm về dao động một cách trực quan và tương tác.
        </p>
      </div>
    </header>

    <nav class="bg-white shadow-sm mb-8">
      <div class="container mx-auto px-4 flex flex-wrap justify-center">
        <button
          class="nav-btn active py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-1-2"
        >
          Bài 1-2: DĐĐH & Mô tả
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-3-5"
        >
          Bài 3-5: Vận tốc, Gia tốc & Năng lượng
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="lesson-6"
        >
          Bài 6: Các loại Dao động
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="simulations"
        >
          Mô Phỏng & Thí Nghiệm
        </button>
        <button
          class="nav-btn py-3 px-2 md:px-4 text-sm md:text-base font-semibold text-slate-600 hover:bg-sky-50"
          data-target="exercises"
        >
          Bài Tập
        </button>
      </div>
    </nav>

    <main class="container mx-auto px-4 pb-12">
      <!-- Bài 1 & 2: Dao động điều hòa và Mô tả dao động -->
      <section id="lesson-1-2" class="content-section active">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 1 & 2: Dao Động Điều Hoà và Các Đại Lượng Đặc Trưng
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Các Khái Niệm Cơ Bản
          </h3>
          <div class="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <p class="mb-4">
                <strong class="font-medium text-sky-600">Dao động cơ:</strong>
                Là chuyển động lặp đi lặp lại của một vật quanh một vị trí đặc
                biệt, gọi là vị trí cân bằng.
              </p>
              <p class="mb-4">
                <strong class="font-medium text-sky-600"
                  >Dao động tuần hoàn:</strong
                >
                Là dao động mà sau những khoảng thời gian bằng nhau (chu kì),
                vật trở lại vị trí cũ theo hướng cũ.
              </p>
              <p class="mb-2">
                <strong class="font-medium text-sky-600"
                  >Dao động điều hoà (DĐĐH):</strong
                >
                Là dao động tuần hoàn trong đó li độ của vật là một hàm côsin
                (hay sin) của thời gian.
              </p>
            </div>
            <div class="text-center">
              <canvas
                id="basic-oscillation-canvas"
                height="150"
                class="w-full max-w-sm mx-auto bg-slate-50 rounded-lg"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Mô phỏng vật dao động quanh vị trí cân bằng (đường nét đứt).
              </p>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Phương Trình và Đồ Thị Dao Động Điều Hoà
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <h4 class="font-semibold text-lg mb-2">Phương trình li độ</h4>
              <div class="formula-card text-center text-xl">
                $x = A\cos(\omega t + \phi)$
              </div>
              <ul class="list-disc list-inside mt-3 space-y-1 text-slate-600">
                <li>$x$: li độ (vị trí của vật)</li>
                <li>$A$: biên độ (li độ cực đại)</li>
                <li>$\omega$: tần số góc (rad/s)</li>
                <li>$(\omega t + \phi)$: pha dao động</li>
                <li>$\phi$: pha ban đầu</li>
              </ul>
            </div>
            <div class="chart-container" style="height: 250px">
              <canvas id="shmGraph"></canvas>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Mối Liên Hệ Giữa DĐĐH và Chuyển Động Tròn Đều
          </h3>
          <p class="text-slate-600 mb-4">
            Dao động điều hoà có thể được coi là hình chiếu của một chuyển động
            tròn đều lên một trục. Điều này giúp giải thích các đại lượng trong
            phương trình DĐĐH.
          </p>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div class="text-center">
              <canvas
                id="circular-motion-canvas"
                class="w-full max-w-xs mx-auto"
                width="250"
                height="250"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Điểm P (DĐĐH) là hình chiếu của điểm M (chuyển động tròn đều).
              </p>
            </div>
            <div>
              <ul class="space-y-2 text-slate-600">
                <li>
                  <strong class="font-medium text-sky-700">Biên độ A</strong>
                  tương ứng với
                  <strong class="font-medium text-sky-700">bán kính</strong> của
                  chuyển động tròn.
                </li>
                <li>
                  <strong class="font-medium text-sky-700"
                    >Tần số góc $\omega$</strong
                  >
                  tương ứng với
                  <strong class="font-medium text-sky-700">tốc độ góc</strong>
                  của chuyển động tròn.
                </li>
                <li>
                  <strong class="font-medium text-sky-700"
                    >Pha dao động $(\omega t + \phi)$</strong
                  >
                  tương ứng với
                  <strong class="font-medium text-sky-700">góc quay</strong> của
                  bán kính tại thời điểm t.
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            4. Các Đại Lượng Đặc Trưng
          </h3>
          <div class="grid md:grid-cols-3 gap-4">
            <div class="formula-card">
              <h4 class="font-semibold">Chu kì (T)</h4>
              <p>$T = \frac{2\pi}{\omega} = \frac{1}{f}$</p>
              <p class="text-sm text-slate-600">
                Thời gian để thực hiện một dao động toàn phần (s).
              </p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Tần số (f)</h4>
              <p>$f = \frac{1}{T} = \frac{\omega}{2\pi}$</p>
              <p class="text-sm text-slate-600">
                Số dao động thực hiện trong một giây (Hz).
              </p>
            </div>
            <div class="formula-card">
              <h4 class="font-semibold">Tần số góc ($\omega$)</h4>
              <p>$\omega = 2\pi f = \frac{2\pi}{T}$</p>
              <p class="text-sm text-slate-600">
                Tốc độ biến thiên của pha (rad/s).
              </p>
            </div>
          </div>
          <p class="mt-4 text-slate-600">
            Biên độ, chu kì, tần số và tần số góc là những hằng số đặc trưng cho
            một dao động cụ thể và hoàn toàn không phụ thuộc vào thời điểm quan
            sát.
          </p>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            5. Pha ban đầu
          </h3>
          <p class="text-slate-600 mb-4">
            Pha ban đầu ($\phi$): Đại lượng này có vai trò xác định trạng thái
            xuất phát của dao động. Nó "cho biết tại thời điểm bắt đầu quan sát
            vật dao động điều hoà ở đâu và sẽ đi về phía nào".
          </p>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            6. Minh Họa Độ Lệch Pha
          </h3>
          <p class="text-slate-600 mb-4">
            Độ lệch pha quan trọng hơn pha, vì nó là đại lượng không đổi, không
            phụ thuộc vào thời điểm quan sát.
          </p>
          <p class="text-slate-600 mb-4">
            Độ lệch pha $\Delta\phi = \phi_2 - \phi_1$ cho biết sự sớm hay trễ
            pha giữa hai dao động.
          </p>
          <div class="grid md:grid-cols-3 gap-8 mt-4 text-center">
            <div>
              <h4 class="font-semibold mb-2">
                Cùng Pha ($\Delta\phi = 2k\pi$ |$(0)$)
              </h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="inPhaseChart"></canvas>
              </div>
            </div>
            <div>
              <h4 class="font-semibold mb-2">
                Ngược Pha ($\Delta\phi = (2k+1)\pi$ | $(\pi)$)
              </h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="outOfPhaseChart"></canvas>
              </div>
            </div>
            <div>
              <h4 class="font-semibold mb-2">
                Vuông Pha ($\Delta\phi = (2k+1)\frac{\pi}{2}$ |
                $(\frac{\pi}{2})$)
              </h4>
              <div class="chart-container" style="height: 150px">
                <canvas id="quadraturePhaseChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bài 3 & 5: Vận tốc, Gia tốc và Năng lượng -->
      <section id="lesson-3-5" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 3 & 5: Vận Tốc, Gia Tốc và Năng Lượng
        </h2>
        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            0. Phương trình li độ
          </h3>
          <div class="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <div class="formula-card mb-4">
                <h4 class="font-semibold">Li độ ($x$)</h4>
                <p>$x = A\cos(\omega t + \phi)$</p>
              </div>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Vận Tốc và Gia Tốc
          </h3>
          <div class="grid md:grid-cols-2 gap-6 items-center">
            <div>
              <div class="formula-card mb-4">
                <h4 class="font-semibold">Vận tốc (v)</h4>
                <p>
                  $v = x' = -\omega A\sin(\omega t + \phi) = \omega A\cos(\omega
                  t + \phi + \frac{\pi}{2})$
                </p>

                <p class="text-sm text-slate-600 mt-1">
                  Độ lớn: $v = \pm\omega\sqrt{A^2 - x^2}$
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Sớm pha $\frac{\pi}{2}$ so với li độ $x$.
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Cực đại tại vị trí cân bằng ($v = \pm\omega A$), bằng 0 tại
                  biên.
                </p>
              </div>
              <div class="formula-card">
                <h4 class="font-semibold">Gia tốc (a)</h4>
                <p>
                  $a = v' = x'' = -\omega^2\cos(\omega t + \phi) =
                  \omega^2\cos(\omega t + \phi + \pi) = -\omega^2x$
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Cực đại tại vị trí biên ($a = \pm\omega^2A$), bằng 0 tại vị
                  trí cân bằng.
                </p>
                <p class="text-sm text-slate-600 mt-1">
                  Ngược pha $\pi$ với li độ $x$ và sớm pha $\frac{\pi}{2}$ so
                  với vận tốc.
                </p>
              </div>
            </div>
            <div class="text-center">
              <canvas
                id="vector-animation-canvas"
                height="180"
                class="w-full max-w-sm mx-auto bg-slate-50 rounded-lg"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Mô phỏng vector vận tốc (<span
                  class="text-emerald-500 font-semibold"
                  >màu xanh</span
                >) và gia tốc (<span class="text-orange-500 font-semibold"
                  >màu cam</span
                >).
              </p>
            </div>
          </div>
          <div class="chart-container mt-6">
            <canvas id="xvaChart"></canvas>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Bảng Tóm Tắt Mối Quan Hệ Giữa x, v, a
          </h3>
          <p class="text-slate-600 mb-4">
            Bảng dưới đây tóm tắt giá trị và trạng thái của các đại lượng li độ,
            vận tốc và gia tốc tại các vị trí đặc biệt trong quá trình dao động.
          </p>
          <div class="overflow-x-auto">
            <table class="w-full text-sm text-left text-slate-500">
              <thead class="text-xs text-slate-700 uppercase bg-slate-100">
                <tr>
                  <th scope="col" class="px-6 py-3">Vị trí</th>
                  <th scope="col" class="px-6 py-3">Li độ (x)</th>
                  <th scope="col" class="px-6 py-3">Vận tốc (v)</th>
                  <th scope="col" class="px-6 py-3">Gia tốc (a)</th>
                </tr>
              </thead>
              <tbody>
                <tr class="bg-white border-b">
                  <th
                    scope="row"
                    class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap"
                  >
                    Biên dương
                  </th>
                  <td class="px-6 py-4">$x = +A$ (Cực đại)</td>
                  <td class="px-6 py-4">$v = 0$</td>
                  <td class="px-6 py-4">$a = -\omega^2A$ (Cực tiểu)</td>
                </tr>
                <tr class="bg-slate-50 border-b">
                  <th
                    scope="row"
                    class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap"
                  >
                    Vị trí cân bằng
                  </th>
                  <td class="px-6 py-4">$x = 0$</td>
                  <td class="px-6 py-4">$v = \pm\omega A$ (Cực đại)</td>
                  <td class="px-6 py-4">$a = 0$</td>
                </tr>
                <tr class="bg-white border-b">
                  <th
                    scope="row"
                    class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap"
                  >
                    Biên âm
                  </th>
                  <td class="px-6 py-4">$x = -A$ (Cực tiểu)</td>
                  <td class="px-6 py-4">$v = 0$</td>
                  <td class="px-6 py-4">$a = +\omega^2A$ (Cực đại)</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Năng Lượng trong DĐĐH
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="mb-4 text-slate-600">
                Cơ năng được bảo toàn. Động năng và thế năng biến thiên tuần
                hoàn, chuyển hóa qua lại lẫn nhau.
              </p>
              <div class="formula-card mb-4">
                <h4 class="font-semibold">Động năng ($W_đ$)</h4>
                <p>$W_đ = \frac{1}{2}mv^2 = \frac{1}{2}m\omega^2(A^2 - x^2)$</p>
                <br />
                <p>$W_đmax = \frac{1}{2}m\omega^2A^2$</p>
              </div>

              <div class="formula-card mb-4">
                <h4 class="font-semibold">Thế năng ($W_t$)</h4>
                <p>$W_t = \frac{1}{2}m\omega^2x^2$</p>
                <br />
                <p>$W_tmax = W_đmax = \frac{1}{2}m\omega^2A^2$</p>
              </div>

              <div class="formula-card">
                <h4 class="font-semibold">Cơ năng ($W$)</h4>
                <p>$W = W_đ + W_t = \frac{1}{2}m\omega^2A^2 = hằng số$</p>
              </div>
            </div>
            <div class="text-center">
              <canvas
                id="energy-bar-canvas"
                height="200"
                class="w-full max-w-sm mx-auto"
              ></canvas>
              <p class="text-sm text-slate-500 mt-2">
                Sự chuyển hoá giữa Động năng (<span
                  class="text-emerald-500 font-semibold"
                  >Wđ</span
                >) và Thế năng (<span class="text-sky-500 font-semibold"
                  >Wt</span
                >).
              </p>
            </div>
          </div>
          <div class="chart-container mt-6">
            <canvas id="energyChart"></canvas>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            4. Các Hệ Dao Động Cơ Học
          </h3>
          <div class="grid md:grid-cols-2 gap-8 mt-4 items-start">
            <div class="text-center">
              <h4 class="text-lg font-semibold mb-2 text-emerald-700">
                Con lắc lò xo
              </h4>
              <div class="spring-container">
                <div class="spring-support"></div>
                <div class="spring-coil"></div>
                <div class="spring-mass">m</div>
              </div>

              <div class="formula-card mt-2">
                <p>Thế năng đàn hồi: $W_t = \frac{1}{2}kx^2$</p>
                <br />
                <p>$\omega = \sqrt{\frac{k}{m}}$</p>
                <br />
                <p>$T = 2\pi\sqrt{\frac{m}{k}}$</p>
                <br />
                <p>$W = \frac{1}{2}kA^2$</p>
              </div>
            </div>
            <div class="text-center">
              <h4 class="text-lg font-semibold mb-2 text-sky-700">
                Con lắc đơn
              </h4>
              <div class="pendulum-container">
                <div class="pendulum-pivot"></div>
                <div class="pendulum-rod"><div class="pendulum-bob"></div></div>
              </div>
              <div class="formula-card mt-2">
                <p>Thế năng trọng trường: $W_t = mgl(1 - \cos\alpha)$</p>
                <br />
                <p>$\omega = \sqrt{\frac{g}{l}}$ (với góc lệch nhỏ)</p>
                <br />
                <p>$T = 2\pi\sqrt{\frac{l}{g}}$</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Bài 6: Các loại dao động khác -->
      <section id="lesson-6" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài 6: Dao Động Tắt Dần, Cưỡng Bức và Cộng Hưởng
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Đồ thị các loại dao động
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="mb-4 text-slate-600">
                Trong thực tế, dao động chịu ảnh hưởng của lực cản và có thể
                chịu tác dụng của ngoại lực.
              </p>
              <div
                class="flex justify-center space-x-2 md:space-x-4 mb-4 flex-wrap"
              >
                <button
                  id="btn-free"
                  class="px-3 py-1.5 text-sm bg-sky-500 text-white rounded-lg hover:bg-sky-600 transition"
                >
                  Tự do
                </button>
                <button
                  id="btn-damped"
                  class="px-3 py-1.5 text-sm bg-amber-500 text-white rounded-lg hover:bg-amber-600 transition"
                >
                  Tắt dần
                </button>
                <button
                  id="btn-forced"
                  class="px-3 py-1.5 text-sm bg-emerald-500 text-white rounded-lg hover:bg-emerald-600 transition"
                >
                  Cưỡng bức
                </button>
              </div>
              <div
                id="oscillation-description"
                class="mt-4 p-3 bg-slate-50 rounded-lg text-slate-700 text-sm min-h-[80px]"
              >
                <!-- Description will be loaded by JS -->
              </div>
            </div>
            <div class="chart-container h-64">
              <canvas id="oscillationTypeChart"></canvas>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Hiện Tượng Cộng Hưởng
          </h3>
          <div class="grid md:grid-cols-2 gap-8 items-center">
            <div>
              <p class="text-slate-600 mb-4">
                Là hiện tượng biên độ dao động cưỡng bức tăng đến giá trị cực
                đại khi tần số của lực cưỡng bức ($f$) tiến đến bằng tần số dao
                động riêng ($f_0$) của hệ. Lực cản càng nhỏ, đỉnh cộng hưởng
                càng nhọn và cao.
              </p>
              <div class="formula-card text-center">
                Điều kiện cộng hưởng: $f = f_0$
              </div>
            </div>
            <div class="chart-container h-64">
              <canvas id="resonanceChart"></canvas>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            3. Ứng Dụng và Tác Hại của Cộng Hưởng
          </h3>
          <div class="mt-4 grid md:grid-cols-2 gap-6">
            <div
              class="bg-emerald-50 border-l-4 border-emerald-500 p-4 rounded"
            >
              <h4 class="font-bold text-emerald-800">Có Lợi</h4>
              <p class="text-sm">
                Hộp đàn guitar, violon (khuếch đại âm), mạch chọn sóng trong
                radio, TV, lò vi sóng.
              </p>
              <img
                src="https://placehold.co/400x200/a7f3d0/14532d?text=Hộp+đàn+Guitar"
                alt="Hộp đàn guitar"
                class="mt-3 rounded-lg w-full object-cover h-32"
              />
            </div>
            <div class="bg-red-50 border-l-4 border-red-500 p-4 rounded">
              <h4 class="font-bold text-red-800">Có Hại</h4>
              <p class="text-sm">
                Cầu, tòa nhà, bệ máy có thể sụp đổ nếu tần số của ngoại lực
                (gió, động cơ...) trùng tần số riêng.
              </p>
              <img
                src="https://placehold.co/400x200/fee2e2/7f1d1d?text=Sập+cầu+Tacoma"
                alt="Sập cầu Tacoma"
                class="mt-3 rounded-lg w-full object-cover h-32"
              />
            </div>
          </div>
        </div>
      </section>

      <!-- Mô phỏng -->
      <section id="simulations" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Thí Nghiệm Tương Tác
        </h2>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            1. Thí Nghiệm Tổng Hợp
          </h3>
          <p class="mb-8 text-slate-600">
            Thay đổi các thông số của một dao động điều hoà để quan sát sự thay
            đổi trên đồ thị li độ, vận tốc, gia tốc và năng lượng.
          </p>
          <div class="grid lg:grid-cols-3 gap-6">
            <!-- Controls -->
            <div class="lg:col-span-1 space-y-4">
              <h4 class="text-lg font-semibold text-slate-700">
                Bảng điều khiển
              </h4>
              <div>
                <label for="amplitude" class="block font-medium mb-1"
                  >Biên độ A (cm)</label
                >
                <input
                  type="range"
                  id="amplitude"
                  min="1"
                  max="10"
                  value="5"
                  step="0.5"
                  class="w-full"
                />
                <p class="text-center mt-1">
                  A = <span id="amplitudeValue">5.0</span> cm
                </p>
              </div>
              <div>
                <label for="omega" class="block font-medium mb-1"
                  >Tần số góc $\omega$ (rad/s)</label
                >
                <input
                  type="range"
                  id="omega"
                  min="0.5"
                  max="5"
                  value="2"
                  step="0.1"
                  class="w-full"
                />
                <p class="text-center mt-1">
                  $\omega$ = <span id="omegaValue">2.0</span> rad/s
                </p>
              </div>
              <div>
                <label for="phi" class="block font-medium mb-1"
                  >Pha ban đầu $\phi$ ($\times \pi$ rad)</label
                >
                <input
                  type="range"
                  id="phi"
                  min="-1"
                  max="1"
                  value="0"
                  step="0.1"
                  class="w-full"
                />
                <p class="text-center mt-1">
                  $\phi$ = <span id="phiValue">0.00</span>$\pi$ rad
                </p>
              </div>

              <h4 class="font-semibold pt-2">Hiển thị đồ thị</h4>
              <div class="space-y-2">
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showX"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                    checked
                  />
                  <label
                    for="showX"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Li độ (x)</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showV"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                    checked
                  />
                  <label
                    for="showV"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Vận tốc (v)</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showA"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                    checked
                  />
                  <label
                    for="showA"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Gia tốc (a)</label
                  >
                </div>
                <div class="flex items-center">
                  <input
                    type="checkbox"
                    id="showEnergy"
                    class="toggle-checkbox h-4 w-4 rounded border-gray-300 text-sky-600 focus:ring-sky-500"
                  />
                  <label
                    for="showEnergy"
                    class="ml-2 block text-sm text-gray-900 toggle-label"
                    >Năng lượng (W, Wđ, Wt)</label
                  >
                </div>
              </div>
            </div>
            <!-- Chart and Animation -->
            <div class="lg:col-span-2">
              <div class="relative w-full aspect-[4/3] max-h-[500px]">
                <canvas id="interactiveChart"></canvas>
              </div>
              <div class="mt-4">
                <h4 class="text-center font-semibold">Mô phỏng vật</h4>
                <canvas
                  id="massAnimation"
                  height="80"
                  class="w-full bg-slate-50 rounded-lg mt-2"
                ></canvas>
              </div>
            </div>
          </div>
        </div>

        <div class="concept-card">
          <h3 class="text-xl font-semibold mb-3 text-slate-700">
            2. Tương Tác: Khảo Sát Độ Lệch Pha
          </h3>
          <p class="mb-4 text-slate-600">
            Sử dụng các thanh trượt để thay đổi pha ban đầu của hai dao động và
            quan sát sự thay đổi trên đồ thị cũng như giá trị độ lệch pha.
          </p>
          <div class="chart-container">
            <canvas id="phaseShiftChart"></canvas>
          </div>
          <div class="grid md:grid-cols-2 gap-6 mt-6">
            <div>
              <label for="phi1" class="block font-medium mb-1"
                >Pha ban đầu $\phi_1$ ($ \times\pi$ rad)</label
              >
              <input
                type="range"
                id="phi1"
                min="-1"
                max="1"
                value="0"
                step="0.1"
                class="w-full"
              />
              <p class="text-center mt-1">
                $\phi_1 = $ <span id="phi1Value">0.00</span>$\pi$ rad
              </p>
            </div>
            <div>
              <label for="phi2" class="block font-medium mb-1"
                >Pha ban đầu $\phi_2$ ($ \times\pi$ rad)</label
              >
              <input
                type="range"
                id="phi2"
                min="-1"
                max="1"
                value="0.5"
                step="0.1"
                class="w-full"
              />
              <p class="text-center mt-1">
                $\phi_2 = $ <span id="phi2Value">0.50</span>$\pi$ rad
              </p>
            </div>
          </div>
          <div
            class="mt-4 text-center text-lg font-semibold bg-sky-100 text-sky-800 p-3 rounded-md"
          >
            Độ lệch pha $\Delta\phi = $
            <span id="deltaPhiValue">0.50</span>$\pi$ rad
          </div>
        </div>
      </section>

      <!-- Bài Tập -->
      <section id="exercises" class="content-section">
        <h2 class="text-2xl font-bold text-sky-700 mb-4">
          Bài Tập Củng Cố Kiến Thức
        </h2>
        <div class="flex flex-col md:flex-row gap-8">
          <!-- Left column for quiz list -->
          <div class="md:w-1/3">
            <h3 class="text-xl font-semibold text-slate-700 mb-3">Luyện tập</h3>
            <div class="mb-4">
              <button
                id="create-new-quiz-btn"
                class="w-full bg-sky-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-sky-700 transition-colors duration-300"
              >
                Tạo bài tập mới
              </button>
            </div>
            <h4 class="text-lg font-semibold text-slate-600 mb-2">
              Lịch sử làm bài
            </h4>
            <div id="saved-quizzes-list" class="space-y-2">
              <!-- Saved quizzes will be listed here -->
              <p class="text-slate-500 text-sm">
                Chưa có bài tập nào được lưu.
              </p>
            </div>
          </div>

          <!-- Right column for the active quiz -->
          <div class="md:w-2/3">
            <div id="quiz-container" class="concept-card">
              <div class="text-center p-8">
                <h3 class="text-xl font-semibold text-slate-700">
                  Chào mừng bạn đến với phần luyện tập!
                </h3>
                <p class="text-slate-600 mt-2">
                  Nhấn nút "Tạo bài tập mới" để bắt đầu một bài kiểm tra ngẫu
                  nhiên gồm 10 câu hỏi.
                </p>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const navButtons = document.querySelectorAll(".nav-btn");
        const contentSections = document.querySelectorAll(".content-section");
        let activeCharts = {};
        let animationFrames = {};

        const cancelAllAnimations = () => {
          Object.values(animationFrames).forEach((id) =>
            cancelAnimationFrame(id)
          );
          animationFrames = {};
        };

        const renderMath = () => {
          renderMathInElement(document.body, {
            delimiters: [
              { left: "$$", right: "$$", display: true },
              { left: "$", right: "$", display: false },
            ],
            throwOnError: false,
          });
        };

        function switchTab(targetId) {
          cancelAllAnimations();
          Object.values(activeCharts).forEach((chart) => {
            if (chart && typeof chart.destroy === "function") {
              chart.destroy();
            }
          });
          activeCharts = {};

          contentSections.forEach((section) =>
            section.classList.remove("active")
          );
          navButtons.forEach((button) => button.classList.remove("active"));

          const targetSection = document.getElementById(targetId);
          const targetButton = document.querySelector(
            `[data-target="${targetId}"]`
          );

          if (targetSection) targetSection.classList.add("active");
          if (targetButton) targetButton.classList.add("active");

          initializeForTab(targetId);
        }

        navButtons.forEach((button) => {
          button.addEventListener("click", () =>
            switchTab(button.getAttribute("data-target"))
          );
        });

        function initializeForTab(targetId) {
          switch (targetId) {
            case "lesson-1-2":
              createBasicOscillationAnimation();
              createShmGraph();
              createCircularMotionAnimation();
              createPhaseCharts();
              break;
            case "lesson-3-5":
              createVectorAnimation();
              createEnergyBarAnimation();
              createXvaChart();
              createEnergyChart();
              break;
            case "lesson-6":
              createOscillationTypeChart();
              createResonanceChart();
              break;
            case "simulations":
              setupComprehensiveSimulation();
              createPhaseShiftChart();
              break;
            case "exercises":
              updateSavedQuizzesList();
              const quizIndex = JSON.parse(
                localStorage.getItem("quizIndex") || "[]"
              );
              if (quizIndex.length > 0) {
                // Render the most recent quiz by default, or show welcome message if none exists
                renderQuiz(quizIndex[0]);
              }
              break;
          }
          // Ensure math is rendered after tab switch
          renderMath();
        }

        const chartDefaultOptions = {
          responsive: true,
          maintainAspectRatio: false,
          interaction: { mode: "index", intersect: false },
          plugins: { legend: { position: "top" } },
        };

        function createBasicOscillationAnimation() {
          const canvas = document.getElementById("basic-oscillation-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height;
            const centerY = h / 2,
              amplitude = w / 2 - 20;
            const x = w / 2 + amplitude * Math.cos(time / 500);
            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.moveTo(w / 2, 0);
            ctx.lineTo(w / 2, h);
            ctx.strokeStyle = "#cbd5e1";
            ctx.setLineDash([5, 3]);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.arc(x, centerY, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "#0ea5e9";
            ctx.fill();
            animationFrames.basic = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createShmGraph() {
          const ctx = document.getElementById("shmGraph")?.getContext("2d");
          if (!ctx) return;
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.25).toFixed(2)
          );
          activeCharts.shm = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Li độ x (cm)",
                  data: labels.map((t) => 10 * Math.cos((Math.PI / 2) * t)),
                  borderColor: "#38bdf8",
                  backgroundColor: "rgba(56, 189, 248, 0.1)",
                  fill: true,
                  tension: 0.4,
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: { title: { display: true, text: "t(s)" } },
                y: { title: { display: true, text: "x(cm)" } },
              },
            },
          });
        }

        function createCircularMotionAnimation() {
          const canvas = document.getElementById("circular-motion-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height;
            const centerX = w / 2,
              centerY = h / 2,
              radius = w / 2 - 20;
            const angle = time / 1000;
            const mX = centerX + radius * Math.cos(angle);
            const mY = centerY - radius * Math.sin(angle); // Use minus for conventional angle direction
            const pX = mX;
            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = "#e2e8f0";
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(centerX, 0);
            ctx.lineTo(centerX, h);
            ctx.strokeStyle = "#cbd5e1";
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(mX, mY);
            ctx.lineTo(pX, centerY);
            ctx.strokeStyle = "#cbd5e1";
            ctx.setLineDash([3, 3]);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.beginPath();
            ctx.arc(mX, mY, 6, 0, 2 * Math.PI);
            ctx.fillStyle = "#f97316";
            ctx.fill();
            ctx.beginPath();
            ctx.arc(pX, centerY, 8, 0, 2 * Math.PI);
            ctx.fillStyle = "#0ea5e9";
            ctx.fill();
            animationFrames.circular = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createVectorAnimation() {
          const canvas = document.getElementById("vector-animation-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height,
              centerY = h / 2 + 20,
              amplitude = w / 2 - 40;
            const omega = 2;
            const t = time / 1000;
            const x_norm = Math.cos(omega * t);
            const v_norm = -Math.sin(omega * t);
            const a_norm = -Math.cos(omega * t);
            const x_pos = w / 2 + x_norm * amplitude;

            ctx.clearRect(0, 0, w, h);
            ctx.beginPath();
            ctx.moveTo(w / 2, 0);
            ctx.lineTo(w / 2, h);
            ctx.strokeStyle = "#cbd5e1";
            ctx.setLineDash([5, 3]);
            ctx.stroke();
            ctx.setLineDash([]);

            ctx.beginPath();
            ctx.moveTo(x_pos, centerY);
            ctx.lineTo(x_pos + v_norm * 30, centerY);
            ctx.strokeStyle = "#10b981";
            ctx.lineWidth = 3;
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(x_pos, centerY + 20);
            ctx.lineTo(x_pos + a_norm * 40, centerY + 20);
            ctx.strokeStyle = "#f97316";
            ctx.lineWidth = 3;
            ctx.stroke();

            ctx.beginPath();
            ctx.arc(x_pos, centerY, 10, 0, 2 * Math.PI);
            ctx.fillStyle = "#0ea5e9";
            ctx.fill();
            animationFrames.vector = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createEnergyBarAnimation() {
          const canvas = document.getElementById("energy-bar-canvas");
          if (!canvas) return;
          const ctx = canvas.getContext("2d");
          const animate = (time) => {
            const w = canvas.width,
              h = canvas.height,
              barWidth = 40,
              maxH = h - 20;
            const t = time / 1000;
            const Wt_norm = Math.pow(Math.cos(t * 2), 2);
            const Wd_norm = Math.pow(Math.sin(t * 2), 2);
            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = "rgba(56, 189, 248, 0.7)";
            ctx.fillRect(
              w / 2 - barWidth - 10,
              maxH * (1 - Wt_norm) + 10,
              barWidth,
              maxH * Wt_norm
            );
            ctx.fillStyle = "rgba(16, 185, 129, 0.7)";
            ctx.fillRect(
              w / 2 + 10,
              maxH * (1 - Wd_norm) + 10,
              barWidth,
              maxH * Wd_norm
            );
            ctx.strokeStyle = "#ef4444";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(w / 2 - barWidth - 20, 10);
            ctx.lineTo(w / 2 + barWidth + 20, 10);
            ctx.stroke();
            ctx.fillStyle = "#334155";
            ctx.font = "12px sans-serif";
            ctx.textAlign = "center";
            ctx.fillText("Wt", w / 2 - barWidth / 2 - 10, h - 5);
            ctx.fillText("Wd", w / 2 + barWidth / 2 + 10, h - 5);
            animationFrames.energy = requestAnimationFrame(animate);
          };
          animate(0);
        }

        function createXvaChart() {
          const ctx = document.getElementById("xvaChart")?.getContext("2d");
          if (!ctx) return;
          const A = 5,
            omega = Math.PI;
          const labels = Array.from({ length: 41 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          activeCharts.xva = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Li độ x (cm)",
                  data: labels.map((t) => A * Math.cos(omega * t)),
                  borderColor: "#38bdf8",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y",
                },
                {
                  label: "Vận tốc v (cm/s)",
                  data: labels.map((t) => -A * omega * Math.sin(omega * t)),
                  borderColor: "#10b981",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y1",
                },
                {
                  label: "Gia tốc a (cm/s²)",
                  data: labels.map(
                    (t) => -A * omega * omega * Math.cos(omega * t)
                  ),
                  borderColor: "#f97316",
                  fill: false,
                  tension: 0.1,
                  yAxisID: "y2",
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: { title: { display: true, text: "Thời gian (s)" } },
                y: {
                  type: "linear",
                  display: true,
                  position: "left",
                  title: { display: true, text: "Li độ (cm)" },
                },
                y1: {
                  type: "linear",
                  display: true,
                  position: "right",
                  grid: { drawOnChartArea: false },
                  title: { display: true, text: "Vận tốc (cm/s)" },
                },
                y2: { display: false },
              },
            },
          });
        }

        function createEnergyChart() {
          const ctx = document.getElementById("energyChart")?.getContext("2d");
          if (!ctx) return;
          const W = 1;
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.1 * Math.PI).toFixed(2)
          );
          activeCharts.energy = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Động năng (Wđ)",
                  data: labels.map((t) => W * Math.pow(Math.sin(2 * t), 2)),
                  backgroundColor: "rgba(16, 185, 129, 0.5)",
                  borderColor: "#10b981",
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Thế năng (Wt)",
                  data: labels.map((t) => W * Math.pow(Math.cos(2 * t), 2)),
                  backgroundColor: "rgba(56, 189, 248, 0.5)",
                  borderColor: "#38bdf8",
                  fill: true,
                  tension: 0.4,
                },
                {
                  label: "Cơ năng (W)",
                  data: labels.map(() => W),
                  borderColor: "#ef4444",
                  fill: false,
                  borderWidth: 3,
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                y: {
                  beginAtZero: true,
                  stacked: true,
                  title: { display: true, text: "Năng lượng (J)" },
                },
                x: { title: { display: true, text: "Pha dao động (rad)" } },
              },
            },
          });
        }

        function createPhaseCharts() {
          const labels = Array.from({ length: 51 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          const data1 = labels.map((t) => 10 * Math.cos(2 * Math.PI * t));
          const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            plugins: { legend: { display: false } },
            scales: {
              x: { ticks: { display: false }, grid: { display: false } },
              y: { ticks: { display: false }, grid: { display: false } },
            },
            elements: { line: { tension: 0.4, pointRadius: 0 } },
          };
          activeCharts.inPhase = new Chart(
            document.getElementById("inPhaseChart")?.getContext("2d"),
            {
              type: "line",
              data: {
                labels,
                datasets: [
                  { data: data1, borderColor: "#38bdf8" },
                  {
                    data: labels.map((t) => 10 * Math.cos(2 * Math.PI * t)),
                    borderColor: "#10b981",
                    borderDash: [5, 5],
                  },
                ],
              },
              options: commonOptions,
            }
          );
          activeCharts.outPhase = new Chart(
            document.getElementById("outOfPhaseChart")?.getContext("2d"),
            {
              type: "line",
              data: {
                labels,
                datasets: [
                  { data: data1, borderColor: "#38bdf8" },
                  {
                    data: labels.map(
                      (t) => 10 * Math.cos(2 * Math.PI * t + Math.PI)
                    ),
                    borderColor: "#f97316",
                    borderDash: [5, 5],
                  },
                ],
              },
              options: commonOptions,
            }
          );
          activeCharts.quadPhase = new Chart(
            document.getElementById("quadraturePhaseChart")?.getContext("2d"),
            {
              type: "line",
              data: {
                labels,
                datasets: [
                  { data: data1, borderColor: "#38bdf8" },
                  {
                    data: labels.map(
                      (t) => 10 * Math.cos(2 * Math.PI * t + Math.PI / 2)
                    ),
                    borderColor: "#a855f7",
                    borderDash: [5, 5],
                  },
                ],
              },
              options: commonOptions,
            }
          );
        }

        function createOscillationTypeChart() {
          const ctx = document
            .getElementById("oscillationTypeChart")
            ?.getContext("2d");
          if (!ctx) return;
          const descriptionDiv = document.getElementById(
            "oscillation-description"
          );
          const labels = Array.from({ length: 101 }, (_, i) =>
            (i * 0.2).toFixed(1)
          );
          const dataSets = {
            free: {
              label: "Dao động tự do",
              data: labels.map((t) => 10 * Math.cos(2 * Math.PI * t)),
              borderColor: "#0ea5e9",
              description: `<h4 class="font-semibold">Dao động Tự do</h4><p>Biên độ và tần số không đổi (lí tưởng).</p>`,
            },
            damped: {
              label: "Dao động tắt dần",
              data: labels.map(
                (t) => 10 * Math.exp(-0.15 * t) * Math.cos(2 * Math.PI * t)
              ),
              borderColor: "#f59e0b",
              description: `<h4 class="font-semibold">Dao động Tắt dần</h4><p>Biên độ giảm dần do lực cản.</p>`,
            },
            forced: {
              label: "Dao động cưỡng bức",
              data: labels.map((t) => 8 * Math.cos(1.8 * Math.PI * t)),
              borderColor: "#10b981",
              description: `<h4 class="font-semibold">Dao động Cưỡng bức</h4><p>Tần số theo ngoại lực, biên độ không đổi.</p>`,
            },
          };
          const chart = new Chart(ctx, {
            type: "line",
            data: { labels: labels, datasets: [dataSets.free] },
            options: {
              ...chartDefaultOptions,
              scales: { y: { min: -12, max: 12 } },
            },
          });
          activeCharts.oscTypes = chart;
          descriptionDiv.innerHTML = dataSets.free.description;
          document.getElementById("btn-free").addEventListener("click", () => {
            chart.data.datasets = [dataSets.free];
            chart.update();
            descriptionDiv.innerHTML = dataSets.free.description;
          });
          document
            .getElementById("btn-damped")
            .addEventListener("click", () => {
              chart.data.datasets = [dataSets.damped];
              chart.update();
              descriptionDiv.innerHTML = dataSets.damped.description;
            });
          document
            .getElementById("btn-forced")
            .addEventListener("click", () => {
              chart.data.datasets = [dataSets.forced];
              chart.update();
              descriptionDiv.innerHTML = dataSets.forced.description;
            });
        }

        function createResonanceChart() {
          const ctx = document
            .getElementById("resonanceChart")
            ?.getContext("2d");
          if (!ctx) return;
          const f0 = 5.0;
          const createResonanceData = (damping) => {
            let data = [];
            for (let f = 0; f <= 10; f += 0.2) {
              const amplitude =
                1 / Math.sqrt(Math.pow(f * f - f0 * f0, 2) + damping * f * f);
              data.push({ x: f, y: amplitude });
            }
            return data;
          };
          activeCharts.resonance = new Chart(ctx, {
            type: "line",
            data: {
              datasets: [
                {
                  label: "Lực cản nhỏ",
                  data: createResonanceData(1),
                  borderColor: "#ef4444",
                  tension: 0.4,
                  fill: false,
                },
                {
                  label: "Lực cản trung bình",
                  data: createResonanceData(10),
                  borderColor: "#f97316",
                  tension: 0.4,
                  fill: false,
                },
                {
                  label: "Lực cản lớn",
                  data: createResonanceData(50),
                  borderColor: "#f59e0b",
                  tension: 0.4,
                  fill: false,
                },
              ],
            },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: {
                  type: "linear",
                  position: "bottom",
                  title: { display: true, text: "Tần số ngoại lực f (Hz)" },
                },
                y: { title: { display: true, text: "Biên độ A" } },
              },
            },
          });
        }

        function setupComprehensiveSimulation() {
          const controls = {
            amp: document.getElementById("amplitude"),
            omega: document.getElementById("omega"),
            phi: document.getElementById("phi"),
            showX: document.getElementById("showX"),
            showV: document.getElementById("showV"),
            showA: document.getElementById("showA"),
            showEnergy: document.getElementById("showEnergy"),
          };
          const values = {
            amp: document.getElementById("amplitudeValue"),
            omega: document.getElementById("omegaValue"),
            phi: document.getElementById("phiValue"),
          };
          const chartCtx = document
            .getElementById("interactiveChart")
            .getContext("2d");
          const animCanvas = document.getElementById("massAnimation");
          const animCtx = animCanvas.getContext("2d");
          const time = Array.from({ length: 101 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          const interactiveChart = new Chart(chartCtx, {
            type: "line",
            data: { labels: time, datasets: [] },
            options: {
              ...chartDefaultOptions,
              scales: {
                x: { title: { display: true, text: "Thời gian t (s)" } },
                y: {
                  type: "linear",
                  position: "left",
                  title: { display: true, text: "x, v, a" },
                },
                yEnergy: {
                  type: "linear",
                  position: "right",
                  grid: { drawOnChartArea: false },
                  title: { display: true, text: "Năng lượng" },
                },
              },
            },
          });
          activeCharts.sim = interactiveChart;
          function updateSimulation() {
            const A = parseFloat(controls.amp.value),
              w = parseFloat(controls.omega.value),
              p = parseFloat(controls.phi.value) * Math.PI,
              m = 0.5,
              k = m * w * w,
              W = 0.5 * k * A * A;
            values.amp.textContent = A.toFixed(1);
            values.omega.textContent = w.toFixed(1);
            values.phi.textContent = (p / Math.PI).toFixed(2);
            const datasets = [];
            if (controls.showX.checked)
              datasets.push({
                label: "Li độ x (cm)",
                data: time.map((t) => A * Math.cos(w * t + p)),
                borderColor: "#38bdf8",
                yAxisID: "y",
                pointRadius: 0,
              });
            if (controls.showV.checked)
              datasets.push({
                label: "Vận tốc v (cm/s)",
                data: time.map((t) => -A * w * Math.sin(w * t + p)),
                borderColor: "#10b981",
                yAxisID: "y",
                pointRadius: 0,
              });
            if (controls.showA.checked)
              datasets.push({
                label: "Gia tốc a (cm/s²)",
                data: time.map((t) => -A * w * w * Math.cos(w * t + p)),
                borderColor: "#f97316",
                yAxisID: "y",
                pointRadius: 0,
              });
            if (controls.showEnergy.checked) {
              datasets.push({
                label: "Động năng Wđ",
                data: time.map(
                  (t) => 0.5 * m * Math.pow(-A * w * Math.sin(w * t + p), 2)
                ),
                borderColor: "#10b981",
                backgroundColor: "rgba(16, 185, 129, 0.2)",
                fill: true,
                yAxisID: "yEnergy",
                pointRadius: 0,
              });
              datasets.push({
                label: "Thế năng Wt",
                data: time.map(
                  (t) => 0.5 * k * Math.pow(A * Math.cos(w * t + p), 2)
                ),
                borderColor: "#38bdf8",
                backgroundColor: "rgba(56, 189, 248, 0.2)",
                fill: true,
                yAxisID: "yEnergy",
                pointRadius: 0,
              });
              datasets.push({
                label: "Cơ năng W",
                data: time.map(() => W),
                borderColor: "#ef4444",
                borderWidth: 3,
                yAxisID: "yEnergy",
                pointRadius: 0,
              });
            }
            interactiveChart.data.datasets = datasets;
            interactiveChart.update();
            if (animationFrames.sim) cancelAnimationFrame(animationFrames.sim);
            window.startTime = performance.now();
            animateMass(window.startTime);
          }
          function animateMass(timestamp) {
            const A_val = parseFloat(controls.amp.value),
              w_val = parseFloat(controls.omega.value),
              p_val = parseFloat(controls.phi.value) * Math.PI;
            const elapsed = (timestamp - window.startTime) / 1000;
            const canvasW = animCanvas.width,
              canvasH = animCanvas.height,
              centerY = canvasH / 2,
              animAmplitude = canvasW / 2 - 20;
            const x_pos = A_val * Math.cos(w_val * elapsed + p_val);
            const screen_x = canvasW / 2 + (x_pos / 10) * animAmplitude;
            animCtx.clearRect(0, 0, canvasW, canvasH);
            animCtx.beginPath();
            animCtx.moveTo(canvasW / 2, 0);
            animCtx.lineTo(canvasW / 2, canvasH);
            animCtx.strokeStyle = "#cbd5e1";
            animCtx.setLineDash([5, 5]);
            animCtx.stroke();
            animCtx.setLineDash([]);
            animCtx.beginPath();
            animCtx.arc(screen_x, centerY, 10, 0, 2 * Math.PI);
            animCtx.fillStyle = "#0ea5e9";
            animCtx.fill();
            animationFrames.sim = requestAnimationFrame(animateMass);
          }
          Object.values(controls).forEach((el) =>
            el.addEventListener("input", updateSimulation)
          );
          updateSimulation();
        }

        function createPhaseShiftChart() {
          const ctx = document
            .getElementById("phaseShiftChart")
            ?.getContext("2d");
          if (!ctx) return;
          const phi1Slider = document.getElementById("phi1"),
            phi2Slider = document.getElementById("phi2");
          const phi1Value = document.getElementById("phi1Value"),
            phi2Value = document.getElementById("phi2Value");
          const deltaPhiValue = document.getElementById("deltaPhiValue");
          const labels = Array.from({ length: 101 }, (_, i) =>
            (i * 0.1).toFixed(1)
          );
          function getWaveData(phi) {
            return labels.map(
              (t) => 10 * Math.cos(Math.PI * t + phi * Math.PI)
            );
          }
          const chart = new Chart(ctx, {
            type: "line",
            data: {
              labels: labels,
              datasets: [
                {
                  label: "Dao động 1",
                  data: getWaveData(parseFloat(phi1Slider.value)),
                  borderColor: "#38bdf8",
                  borderWidth: 2,
                  pointRadius: 0,
                },
                {
                  label: "Dao động 2",
                  data: getWaveData(parseFloat(phi2Slider.value)),
                  borderColor: "#10b981",
                  borderWidth: 2,
                  pointRadius: 0,
                  borderDash: [5, 5],
                },
              ],
            },
            options: chartDefaultOptions,
          });
          activeCharts.phaseShift = chart;
          function updateChart() {
            const phi1 = parseFloat(phi1Slider.value),
              phi2 = parseFloat(phi2Slider.value);
            phi1Value.textContent = phi1.toFixed(2);
            phi2Value.textContent = phi2.toFixed(2);
            deltaPhiValue.textContent = (phi2 - phi1).toFixed(2);
            chart.data.datasets[0].data = getWaveData(phi1);
            chart.data.datasets[1].data = getWaveData(phi2);
            chart.update();
          }
          phi1Slider.addEventListener("input", updateChart);
          phi2Slider.addEventListener("input", updateChart);
          updateChart();
        }

        // --- New Quiz Logic ---

        // 1. Question Bank (Simulating a large database)
        const questionBank = [
          // --- Dễ ---
          {
            id: 1,
            type: "multiple-choice",
            difficulty: "dễ",
            question:
              "Trong dao động điều hoà, đại lượng nào sau đây không thay đổi theo thời gian?",
            options: ["Li độ", "Vận tốc", "Biên độ", "Gia tốc"],
            answer: "Biên độ",
            explanation:
              "Biên độ là giá trị cực đại của li độ, là một hằng số trong DĐĐH.",
          },
          {
            id: 2,
            type: "true-false",
            difficulty: "dễ",
            question:
              "Dao động của con lắc đồng hồ là dao động duy trì. Đúng hay Sai?",
            answer: true,
            explanation:
              "Con lắc đồng hồ được cung cấp năng lượng để bù lại tiêu hao do ma sát, nên là dao động duy trì.",
          },
          {
            id: 3,
            type: "short-answer",
            difficulty: "dễ",
            question: "Đơn vị của tần số trong hệ SI là gì?",
            answer: "Hz",
            explanation: "Đơn vị của tần số là Hertz, ký hiệu là Hz.",
          },
          {
            id: 4,
            type: "multiple-choice",
            difficulty: "dễ",
            question: "Công thức liên hệ giữa chu kì (T) và tần số (f) là:",
            options: ["T = 2πf", "T = 1/f", "T = f", "T = f/2π"],
            answer: "T = 1/f",
            explanation: "Chu kì là nghịch đảo của tần số.",
          },
          {
            id: 5,
            type: "true-false",
            difficulty: "dễ",
            question:
              "Tại vị trí cân bằng, vận tốc của vật dao động điều hòa bằng 0. Đúng hay Sai?",
            answer: false,
            explanation:
              "Tại vị trí cân bằng, vận tốc của vật đạt giá trị cực đại.",
          },
          {
            id: 6,
            type: "multiple-choice",
            difficulty: "dễ",
            question: "Pha ban đầu ($\phi$) cho biết điều gì?",
            options: [
              "Năng lượng của vật",
              "Trạng thái dao động ở t=0",
              "Tốc độ của vật",
              "Chu kì dao động",
            ],
            answer: "Trạng thái dao động ở t=0",
            explanation:
              "Pha ban đầu xác định vị trí và chiều chuyển động của vật tại thời điểm ban đầu t=0.",
          },
          {
            id: 7,
            type: "short-answer",
            difficulty: "dễ",
            question:
              "Một vật dao động với tần số 50 Hz thì chu kì dao động là bao nhiêu giây?",
            answer: "0.02",
            explanation: "T = 1/f = 1/50 = 0.02 s.",
          },
          {
            id: 8,
            type: "multiple-choice",
            difficulty: "dễ",
            question:
              "Lực kéo về tác dụng lên vật dao động điều hoà có đặc điểm nào?",
            options: [
              "Luôn hướng ra xa vị trí cân bằng",
              "Luôn hướng về vị trí cân bằng",
              "Có độ lớn không đổi",
              "Luôn cùng chiều với vận tốc",
            ],
            answer: "Luôn hướng về vị trí cân bằng",
            explanation:
              "Lực kéo về luôn có xu hướng đưa vật trở về vị trí cân bằng.",
          },

          // --- Trung Bình ---
          {
            id: 10,
            type: "multiple-choice",
            difficulty: "trung bình",
            question:
              "Một con lắc lò xo có độ cứng k, khối lượng m. Chu kì dao động riêng của nó là:",
            options: [
              "$T=2\\pi\\sqrt{\\frac{k}{m}}$",
              "$T=2\\pi\\sqrt{\\frac{m}{k}}$",
              "$T=\\frac{1}{2\\pi}\\sqrt{\\frac{k}{m}}$",
              "$T=\\frac{1}{2\\pi}\\sqrt{\\frac{m}{k}}$",
            ],
            answer: "$T=2\\pi\\sqrt{\\frac{m}{k}}$",
            explanation: "Đây là công thức tính chu kì của con lắc lò xo.",
          },
          {
            id: 11,
            type: "short-answer",
            difficulty: "trung bình",
            question:
              "Một vật DĐĐH với phương trình $x = 5\\cos(4\\pi t + \\pi/2)$ cm. Tần số góc của dao động là bao nhiêu (rad/s)?",
            answer: "4π",
            explanation:
              "Từ phương trình $x = A\\cos(\\omega t + \\phi)$, ta có $\\omega = 4\\pi$ rad/s.",
          },
          {
            id: 12,
            type: "true-false",
            difficulty: "trung bình",
            question:
              "Trong dao động tắt dần, cơ năng của hệ luôn được bảo toàn. Đúng hay Sai?",
            answer: false,
            explanation:
              "Trong dao động tắt dần, cơ năng giảm dần theo thời gian do tác dụng của lực cản.",
          },
          {
            id: 13,
            type: "multiple-choice",
            difficulty: "trung bình",
            question: "Vận tốc của vật DĐĐH sớm pha hơn li độ một góc là:",
            options: ["$\\pi/2$", "$\\pi$", "$-\\pi/2$", "0"],
            answer: "$\\pi/2$",
            explanation:
              "Phương trình vận tốc $v = \\omega A\\cos(\\omega t + \\phi + \\pi/2)$, do đó v sớm pha $\\pi/2$ so với x.",
          },
          {
            id: 14,
            type: "short-answer",
            difficulty: "trung bình",
            question:
              "Một con lắc đơn dài 1m dao động tại nơi có $g = \\pi^2$ m/s². Chu kì của nó là bao nhiêu giây?",
            answer: "2",
            explanation:
              "Áp dụng công thức $T = 2\\pi\\sqrt{l/g} = 2\\pi\\sqrt{1/\\pi^2} = 2$ s.",
          },
          {
            id: 15,
            type: "multiple-choice",
            difficulty: "trung bình",
            question: "Hiện tượng cộng hưởng xảy ra khi nào?",
            options: [
              "Tần số ngoại lực lớn hơn tần số riêng",
              "Tần số ngoại lực nhỏ hơn tần số riêng",
              "Tần số ngoại lực bằng tần số riêng",
              "Biên độ ngoại lực rất lớn",
            ],
            answer: "Tần số ngoại lực bằng tần số riêng",
            explanation:
              "Cộng hưởng là hiện tượng biên độ dao động cưỡng bức tăng đột ngột khi tần số lực cưỡng bức bằng tần số dao động riêng của hệ.",
          },
          {
            id: 16,
            type: "true-false",
            difficulty: "trung bình",
            question:
              "Động năng và thế năng của vật DĐĐH biến thiên tuần hoàn với tần số gấp đôi tần số dao động của vật. Đúng hay Sai?",
            answer: true,
            explanation:
              "Vì $W_t \\propto \\cos^2$ và $W_đ \\propto \\sin^2$, chúng biến thiên với tần số góc $2\\omega$ và tần số $2f$.",
          },
          {
            id: 17,
            type: "multiple-true-false",
            difficulty: "trung bình",
            question:
              "Một vật dao động điều hòa. Các phát biểu sau đây đúng hay sai?",
            statements: [
              {
                text: "a) Vận tốc của vật bằng không khi vật ở vị trí biên.",
                isCorrect: true,
              },
              {
                text: "b) Gia tốc của vật luôn cùng chiều với véc tơ vận tốc.",
                isCorrect: false,
              },
              {
                text: "c) Lực kéo về tác dụng lên vật không đổi.",
                isCorrect: false,
              },
              {
                text: "d) Khi vật đi từ VTCB ra biên, động năng giảm dần.",
                isCorrect: true,
              },
            ],
            explanation:
              "a) Đúng, ở biên vật đổi chiều chuyển động. b) Sai, a và v chỉ cùng chiều khi vật CĐ nhanh dần về VTCB. c) Sai, Fkv phụ thuộc li độ x. d) Đúng, v giảm nên Wđ giảm.",
          },

          // --- Khó ---
          {
            id: 20,
            type: "multiple-choice",
            difficulty: "khó",
            question:
              "Một vật DĐĐH, khi vật có li độ $x_1$ thì vận tốc là $v_1$, khi có li độ $x_2$ thì vận tốc là $v_2$. Tần số góc được tính bằng công thức:",
            options: [
              "$\\omega^2 = \\frac{v_1^2 - v_2^2}{x_2^2 - x_1^2}$",
              "$\\omega^2 = \\frac{v_2^2 - v_1^2}{x_2^2 - x_1^2}$",
              "$\\omega^2 = \\frac{v_1^2 + v_2^2}{x_1^2 + x_2^2}$",
              "$\\omega^2 = \\frac{v_1^2 - v_2^2}{x_1^2 - x_2^2}$",
            ],
            answer: "$\\omega^2 = \\frac{v_1^2 - v_2^2}{x_2^2 - x_1^2}$",
            explanation:
              "Từ hệ thức độc lập thời gian $A^2 = x^2 + (v/\\omega)^2$, ta có $\\omega^2(A^2 - x_1^2) = v_1^2$ và $\\omega^2(A^2 - x_2^2) = v_2^2$. Trừ hai vế ta được đáp án.",
          },
          {
            id: 21,
            type: "short-answer",
            difficulty: "khó",
            question:
              "Một con lắc lò xo treo thẳng đứng, tại VTCB lò xo dãn 4cm. Lấy $g=10$ m/s². Chu kì dao động của con lắc là bao nhiêu (s)? (Làm tròn 2 chữ số thập phân)",
            answer: "0.40",
            explanation:
              "Tại VTCB, $mg = k\\Delta l_0 \\Rightarrow \\omega = \\sqrt{k/m} = \\sqrt{g/\\Delta l_0} = \\sqrt{10/0.04} = 5\\pi$. Vậy $T = 2\\pi/\\omega = 2\\pi/(5\\pi) = 0.4$ s.",
          },
          {
            id: 22,
            type: "true-false",
            difficulty: "khó",
            question:
              "Hai dao động điều hòa cùng phương, cùng tần số có biên độ $A_1, A_2$. Biên độ dao động tổng hợp A luôn thỏa mãn $|A_1 - A_2| \\le A \\le A_1 + A_2$. Đúng hay Sai?",
            answer: true,
            explanation:
              "Đây là công thức tổng hợp dao động, biên độ tổng hợp nằm trong khoảng từ hiệu đến tổng hai biên độ thành phần.",
          },
          {
            id: 23,
            type: "multiple-choice",
            difficulty: "khó",
            question:
              "Một vật DĐĐH với biên độ A. Thời gian ngắn nhất để vật đi từ vị trí $x = -A/2$ đến $x=A$ là $T/k$. Tìm k?",
            options: ["3", "4", "6", "8"],
            answer: "3",
            explanation:
              "Thời gian đi từ -A/2 đến VTCB là T/12. Thời gian đi từ VTCB đến A là T/4. Tổng thời gian là T/12 + T/4 = 4T/12 = T/3. Vậy k=3.",
          },
          {
            id: 24,
            type: "short-answer",
            difficulty: "khó",
            question:
              "Một vật DĐĐH có cơ năng W. Khi động năng bằng 3 lần thế năng, li độ của vật theo biên độ A là bao nhiêu? (Ví dụ: A/k hoặc -A/k)",
            answer: "A/2|-A/2",
            explanation:
              "$W_đ = 3W_t \\Rightarrow W = W_đ + W_t = 4W_t \\Rightarrow \\frac{1}{2}kA^2 = 4(\\frac{1}{2}kx^2) \\Rightarrow A^2 = 4x^2 \\Rightarrow x = \\pm A/2$.",
          },
          {
            id: 25,
            type: "multiple-true-false",
            difficulty: "khó",
            question:
              "Một con lắc đơn dao động điều hòa. Các phát biểu sau đây đúng hay sai?",
            statements: [
              {
                text: "a) Chu kì dao động phụ thuộc vào khối lượng của vật nặng.",
                isCorrect: false,
              },
              {
                text: "b) Khi tăng chiều dài dây treo lên 4 lần, chu kì dao động tăng 2 lần.",
                isCorrect: true,
              },
              {
                text: "c) Lực căng dây có giá trị lớn nhất khi vật ở vị trí cân bằng.",
                isCorrect: true,
              },
              {
                text: "d) Dao động của con lắc đơn luôn là dao động điều hòa.",
                isCorrect: false,
              },
            ],
            explanation:
              "a) Sai, T không phụ thuộc m. b) Đúng, T tỉ lệ với căn bậc hai của l. c) Đúng, $T_{max} = mg(3-2\\cos\\alpha_0)$ tại VTCB. d) Sai, chỉ là DĐĐH khi góc lệch nhỏ.",
          },
          // Adding more questions to reach a larger bank
          {
            id: 26,
            type: "multiple-choice",
            difficulty: "dễ",
            question:
              "Dao động tắt dần có đại lượng nào sau đây giảm liên tục theo thời gian?",
            options: ["Li độ", "Tần số", "Biên độ và Năng lượng", "Pha"],
            answer: "Biên độ và Năng lượng",
            explanation:
              "Do có lực cản, biên độ và năng lượng của dao động tắt dần giảm dần theo thời gian.",
          },
          {
            id: 27,
            type: "true-false",
            difficulty: "dễ",
            question:
              "Dao động cưỡng bức có tần số bằng tần số của lực cưỡng bức. Đúng hay Sai?",
            answer: true,
            explanation:
              "Khi dao động đã ổn định, tần số của hệ dao động bằng tần số của ngoại lực cưỡng bức.",
          },
          {
            id: 28,
            type: "short-answer",
            difficulty: "trung bình",
            question:
              "Một vật thực hiện đồng thời hai dao động $x_1 = 3\\cos(10t)$ cm và $x_2 = 4\\sin(10t)$ cm. Biên độ dao động tổng hợp là bao nhiêu cm?",
            answer: "5",
            explanation:
              "$x_2 = 4\\cos(10t - \\pi/2)$. Hai dao động vuông pha nên $A = \\sqrt{A_1^2 + A_2^2} = \\sqrt{3^2 + 4^2} = 5$ cm.",
          },
          {
            id: 29,
            type: "multiple-choice",
            difficulty: "trung bình",
            question:
              "Trong DĐĐH, cặp đại lượng nào sau đây biến thiên cùng tần số và cùng pha?",
            options: [
              "Li độ và Vận tốc",
              "Vận tốc và Gia tốc",
              "Li độ và Lực kéo về",
              "Gia tốc và Lực kéo về",
            ],
            answer: "Gia tốc và Lực kéo về",
            explanation: "Vì $F_{kv} = ma$, nên F và a luôn cùng pha.",
          },
        ];

        // Utility to shuffle an array
        function shuffleArray(array) {
          for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
          }
        }

        // Generate a new quiz, save it, and render it
        function createNewQuiz() {
          const easyQs = questionBank.filter((q) => q.difficulty === "dễ");
          const mediumQs = questionBank.filter(
            (q) => q.difficulty === "trung bình"
          );
          const hardQs = questionBank.filter((q) => q.difficulty === "khó");

          shuffleArray(easyQs);
          shuffleArray(mediumQs);
          shuffleArray(hardQs);

          // Ensure we have enough questions, otherwise take what's available
          const numEasy = Math.min(3, easyQs.length);
          const numMedium = Math.min(4, mediumQs.length);
          const numHard = Math.min(3, hardQs.length);

          let finalQuizQuestions = [
            ...easyQs.slice(0, numEasy),
            ...mediumQs.slice(0, numMedium),
            ...hardQs.slice(0, numHard),
          ];

          shuffleArray(finalQuizQuestions);

          const quizId = `quiz_${new Date().getTime()}`;
          const quizData = {
            id: quizId,
            createdAt: new Date().toLocaleString("vi-VN"),
            questions: finalQuizQuestions,
            userAnswers: {},
            score: null,
          };

          localStorage.setItem(quizId, JSON.stringify(quizData));
          const quizIndex = JSON.parse(
            localStorage.getItem("quizIndex") || "[]"
          );
          quizIndex.unshift(quizId);
          localStorage.setItem("quizIndex", JSON.stringify(quizIndex));

          updateSavedQuizzesList();
          renderQuiz(quizId);
        }

        // Render the list of saved quizzes
        function updateSavedQuizzesList() {
          const listEl = document.getElementById("saved-quizzes-list");
          const quizIndex = JSON.parse(
            localStorage.getItem("quizIndex") || "[]"
          );

          if (quizIndex.length === 0) {
            listEl.innerHTML = `<p class="text-slate-500 text-sm">Chưa có bài tập nào được lưu.</p>`;
            return;
          }

          listEl.innerHTML = quizIndex
            .map((quizId) => {
              const quizData = JSON.parse(localStorage.getItem(quizId));
              if (!quizData) return "";
              const scoreDisplay =
                quizData.score !== null
                  ? `${Number(quizData.score.toFixed(2))}/${
                      quizData.questions.length
                    }`
                  : "Chưa làm";
              const scoreInfo =
                quizData.score !== null
                  ? `<span class="font-bold text-sky-700">${scoreDisplay}</span>`
                  : "Chưa làm";
              return `
                    <button class="w-full text-left p-2 rounded-md hover:bg-sky-100 transition quiz-loader-btn" data-quiz-id="${quizId}">
                        <span class="block font-medium text-slate-800">Bài tập ${quizData.createdAt}</span>
                        <span class="text-sm text-slate-500">Kết quả: ${scoreInfo}</span>
                    </button>
                `;
            })
            .join("");

          document.querySelectorAll(".quiz-loader-btn").forEach((btn) => {
            btn.addEventListener("click", () => {
              renderQuiz(btn.dataset.quizId);
            });
          });
        }

        // Render a specific quiz into the container
        function renderQuiz(quizId) {
          const quizData = JSON.parse(localStorage.getItem(quizId));
          if (!quizData) {
            console.error("Quiz not found:", quizId);
            return;
          }

          const container = document.getElementById("quiz-container");
          let questionsHTML = quizData.questions
            .map((q, index) => {
              let optionsHTML = "";
              const savedAnswers = quizData.userAnswers[q.id];

              if (q.type === "multiple-choice") {
                optionsHTML = q.options
                  .map((option, o_index) => {
                    const checked = savedAnswers === option ? "checked" : "";
                    return `
                            <div>
                                <input type="radio" name="q-${q.id}" id="q-${q.id}-${o_index}" value="${option}" ${checked} class="hidden">
                                <label for="q-${q.id}-${o_index}" class="block p-3 border border-slate-300 rounded-lg mb-2 cursor-pointer transition hover:bg-sky-50">${option}</label>
                            </div>
                        `;
                  })
                  .join("");
              } else if (q.type === "true-false") {
                const checkedTrue = savedAnswers === true ? "checked" : "";
                const checkedFalse = savedAnswers === false ? "checked" : "";
                optionsHTML = `
                        <div>
                            <input type="radio" name="q-${q.id}" id="q-${q.id}-true" value="true" ${checkedTrue} class="hidden">
                            <label for="q-${q.id}-true" class="block p-3 border border-slate-300 rounded-lg mb-2 cursor-pointer transition hover:bg-sky-50">Đúng</label>
                        </div>
                        <div>
                            <input type="radio" name="q-${q.id}" id="q-${q.id}-false" value="false" ${checkedFalse} class="hidden">
                            <label for="q-${q.id}-false" class="block p-3 border border-slate-300 rounded-lg mb-2 cursor-pointer transition hover:bg-sky-50">Sai</label>
                        </div>
                    `;
              } else if (q.type === "short-answer") {
                const value =
                  savedAnswers !== undefined && savedAnswers !== null
                    ? savedAnswers
                    : "";
                optionsHTML = `
                        <input type="text" name="q-${q.id}" class="w-full p-2 border border-slate-300 rounded-lg" value="${value}" placeholder="Nhập câu trả lời của bạn...">
                    `;
              } else if (q.type === "multiple-true-false") {
                optionsHTML =
                  `<div class="space-y-4">` +
                  q.statements
                    .map((stmt, s_index) => {
                      const savedAnswer = savedAnswers
                        ? savedAnswers[s_index]
                        : null;
                      const checkedTrue = savedAnswer === true ? "checked" : "";
                      const checkedFalse =
                        savedAnswer === false ? "checked" : "";
                      return `
                            <div class="p-3 border-l-4 border-slate-200 statement-item">
                                <p class="mb-2">${stmt.text}</p>
                                <div class="flex items-center space-x-4">
                                    <input type="radio" name="q-${q.id}-${s_index}" id="q-${q.id}-${s_index}-true" value="true" class="hidden" ${checkedTrue}>
                                    <label for="q-${q.id}-${s_index}-true" class="cursor-pointer px-4 py-1.5 border border-slate-300 rounded-md text-sm transition hover:bg-sky-50">Đúng</label>
                                    
                                    <input type="radio" name="q-${q.id}-${s_index}" id="q-${q.id}-${s_index}-false" value="false" class="hidden" ${checkedFalse}>
                                    <label for="q-${q.id}-${s_index}-false" class="cursor-pointer px-4 py-1.5 border border-slate-300 rounded-md text-sm transition hover:bg-sky-50">Sai</label>
                                </div>
                            </div>
                        `;
                    })
                    .join("") +
                  `</div>`;
              }

              return `
                    <div class="quiz-question" id="question-${q.id}">
                        <p class="font-semibold mb-3">Câu ${index + 1}: ${
                q.question
              }</p>
                        <div class="quiz-options">${optionsHTML}</div>
                        <div class="explanation" id="explanation-${q.id}"></div>
                    </div>
                `;
            })
            .join("");

          const buttonText =
            quizData.score !== null ? "Làm Lại" : "Kiểm Tra Đáp Án";

          container.innerHTML = `
                <h3 class="text-xl font-bold text-sky-700 mb-6">Bài tập ngày: ${quizData.createdAt}</h3>
                <div id="quiz-form">${questionsHTML}</div>
                 <div class="text-center mt-8">
                    <button
                      id="check-quiz-btn"
                      data-quiz-id="${quizId}"
                      class="bg-sky-600 text-white font-semibold py-3 px-8 rounded-lg hover:bg-sky-700 transition-colors duration-300"
                    >
                      ${buttonText}
                    </button>
                    <div id="quiz-result" class="mt-6 text-xl font-bold"></div>
                  </div>
            `;

          renderMathInElement(container);

          document
            .getElementById("check-quiz-btn")
            .addEventListener("click", (e) => {
              const currentQuizId = e.target.dataset.quizId;
              const currentQuizData = JSON.parse(
                localStorage.getItem(currentQuizId)
              );
              if (currentQuizData.score !== null) {
                currentQuizData.score = null;
                currentQuizData.userAnswers = {};
                localStorage.setItem(
                  currentQuizId,
                  JSON.stringify(currentQuizData)
                );
                renderQuiz(currentQuizId);
              } else {
                checkCurrentQuizAnswers(currentQuizId);
              }
            });

          if (quizData.score !== null) {
            checkCurrentQuizAnswers(quizId, true); // Rerun check to show results
          }
        }

        function checkCurrentQuizAnswers(quizId, showOnly = false) {
          const quizData = JSON.parse(localStorage.getItem(quizId));
          if (!quizData) return;

          let score = 0;
          const userAnswers = {};

          quizData.questions.forEach((q) => {
            const explanationEl = document.getElementById(
              `explanation-${q.id}`
            );
            const optionElements = document.querySelectorAll(
              `#question-${q.id} .quiz-options label`
            );
            optionElements.forEach((label) =>
              label.classList.remove("correct", "incorrect")
            );

            let userAnswer;
            let isCorrect = false;

            if (q.type === "multiple-choice") {
              const selectedOption = document.querySelector(
                `input[name="q-${q.id}"]:checked`
              );
              userAnswer = selectedOption ? selectedOption.value : null;
              isCorrect = userAnswer === q.answer;
              if (isCorrect) score++;
            } else if (q.type === "true-false") {
              const selectedOption = document.querySelector(
                `input[name="q-${q.id}"]:checked`
              );
              userAnswer = selectedOption
                ? selectedOption.value === "true"
                : null;
              isCorrect = userAnswer === q.answer;
              if (isCorrect) score++;
            } else if (q.type === "short-answer") {
              const inputEl = document.querySelector(`input[name="q-${q.id}"]`);
              userAnswer = inputEl ? inputEl.value.trim() : "";
              const correctAnswers = String(q.answer)
                .split("|")
                .map((a) => a.toLowerCase().trim());
              isCorrect = correctAnswers.includes(userAnswer.toLowerCase());
              if (isCorrect) score++;
            } else if (q.type === "multiple-true-false") {
              let questionScore = 0;
              let statementAnswers = [];
              q.statements.forEach((stmt, s_index) => {
                const selectedOption = document.querySelector(
                  `input[name="q-${q.id}-${s_index}"]:checked`
                );
                const currentAnswer = selectedOption
                  ? selectedOption.value === "true"
                  : null;
                statementAnswers.push(currentAnswer);

                if (currentAnswer === stmt.isCorrect) {
                  questionScore += 0.25;
                  if (selectedOption) {
                    selectedOption.nextElementSibling.classList.add("correct");
                  }
                } else {
                  if (selectedOption) {
                    selectedOption.nextElementSibling.classList.add(
                      "incorrect"
                    );
                  }
                  const correctLabel = document.querySelector(
                    `label[for="q-${q.id}-${s_index}-${stmt.isCorrect}"]`
                  );
                  if (correctLabel) correctLabel.classList.add("correct");
                }
              });
              score += questionScore;
              userAnswer = statementAnswers;
              explanationEl.innerHTML = q.explanation;
              explanationEl.className = "explanation correct";
            }

            userAnswers[q.id] = userAnswer;

            if (q.type !== "multiple-true-false") {
              const selectedLabel = document.querySelector(
                `input[name="q-${q.id}"]:checked + label`
              );
              if (isCorrect) {
                if (selectedLabel) selectedLabel.classList.add("correct");
                explanationEl.innerHTML = `<span class="font-bold">Đúng!</span> ${q.explanation}`;
                explanationEl.className = "explanation correct";
              } else {
                if (selectedLabel) selectedLabel.classList.add("incorrect");
                if (q.type === "multiple-choice" || q.type === "true-false") {
                  const correctAnswerValue = String(q.answer);
                  // For true-false, value is 'true' or 'false'
                  const correctInput =
                    q.type === "true-false"
                      ? document.querySelector(
                          `input[name="q-${q.id}"][value="${q.answer}"]`
                        )
                      : document.querySelector(
                          `input[name="q-${q.id}"][value="${correctAnswerValue}"]`
                        );

                  if (correctInput) {
                    document
                      .querySelector(`label[for="${correctInput.id}"]`)
                      .classList.add("correct");
                  }
                }
                explanationEl.innerHTML = `<span class="font-bold">Sai.</span> ${q.explanation}`;
                explanationEl.className = "explanation incorrect";
              }
            }
            renderMathInElement(explanationEl);
          });

          const resultEl = document.getElementById("quiz-result");
          resultEl.textContent = `Kết quả: Bạn đã trả lời đúng ${Number(
            score.toFixed(2)
          )}/${quizData.questions.length} điểm!`;

          if (!showOnly) {
            quizData.score = score;
            quizData.userAnswers = userAnswers;
            localStorage.setItem(quizId, JSON.stringify(quizData));
            updateSavedQuizzesList();
            document.getElementById("check-quiz-btn").textContent = "Làm Lại";
          }
        }

        // --- Initial Load ---
        document
          .getElementById("create-new-quiz-btn")
          .addEventListener("click", createNewQuiz);
        switchTab("lesson-1-2");
      });
    </script>
  </body>
</html>
